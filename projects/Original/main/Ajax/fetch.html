<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="160">AJAX и COMET</a></nav-up><h1>Метод fetch: замена XMLHttpRequest</h1><p>Метод <a href="https://fetch.spec.whatwg.org/">fetch</a> – это <code>XMLHttpRequest</code> нового поколения. Он предоставляет улучшенный интерфейс для осуществления запросов к серверу: как по части возможностей и контроля над происходящим, так и по синтаксису, так как построен на <a href="/promise">промисах</a>.</p><p>Поддержка в браузерах пока не очень распространена, но есть <a href="https://github.com/github/fetch">полифилл</a> и не один.</p><h2><a name="0" href="#0">Синтаксис</a></h2><p>Синтаксис метода <code>fetch</code>:</p><code-example><script>`let promise = fetch(url[, options]);`</script></code-example><ul><li><code>url</code> – URL, на который сделать запрос,</li><li><code>options</code> – необязательный объект с настройками запроса.</li></ul><p>Свойства <code>options</code>:</p><ul><li><code>method</code> – метод запроса,</li><li><code>headers</code> – заголовки запроса (объект),</li><li><code>body</code> – тело запроса: <code>FormData</code>, <code>Blob</code>, строка и т.п.</li><li><code>mode</code> – одно из: «same-origin», «no-cors», «cors», указывает, в каком режиме кросс-доменности предполагается делать запрос.</li><li><code>credentials</code> – одно из: «omit», «same-origin», «include», указывает, пересылать ли куки и заголовки авторизации вместе с запросом.</li><li><code>cache</code> – одно из «default», «no-store», «reload», «no-cache», «force-cache», «only-if-cached», указывает, как кешировать запрос.</li><li><code>redirect</code> – можно поставить «follow» для обычного поведения при коде 30x (следовать редиректу) или «error» для интерпретации редиректа как ошибки.</li></ul><p>Как видно, всевозможных настроек здесь больше, чем в <code>XMLHttpRequest</code>. Вместе с тем, надо понимать, что если мы используем полифилл, то ничего более гибкого, чем оригинальный <code>XMLHttpRequest</code> мы из этого не получим.</p><p>Разве что, <code>fetch</code>, возможно, будет удобнее пользоваться.</p><h2><a name="1" href="#1">Использование</a></h2><p>При вызове <code>fetch</code> возвращает промис, который, когда получен ответ, выполняет коллбэки с объектом <a href="https://fetch.spec.whatwg.org/#response">Response</a> или с ошибкой, если запрос не удался.</p><p>Пример использования:</p><code-example><script>`'use strict';\n\nfetch('user.json')\n  .then(function(response) {\n    alert(response.headers.get('Content-Type')); // text/html; charset=utf-8\n    alert(response.status); // 200\n\n    return response.json();\n   })\n  .then(function(user) {\n    alert(user.name); // iliakan\n  })\n  .catch( alert );`</script><code-toolbar></code-toolbar></code-example><p>Объект <code>response</code> кроме доступа к заголовкам <code>headers</code>, статусу <code>status</code> и некоторым другим полям ответа, даёт возможность прочитать его тело, в желаемом формате.</p><p>Варианты описаны в спецификации <a href="https://fetch.spec.whatwg.org/#body">Body</a>, они включают в себя:</p><ul><li><code>response.arrayBuffer()</code></li><li><code>response.blob()</code></li><li><code>response.formData()</code></li><li><code>response.json()</code></li><li><code>response.text()</code></li></ul><p>Соответствующий вызов возвращает промис, который, когда ответ будет получен, вызовет коллбэк с результатом.</p><p>В примере выше мы можем в первом <code>.then</code> проанализировать ответ и, если он нас устроит – вернуть промис с нужным форматом. Следующий <code>.then</code> уже будет содержать полный ответ сервера.</p><p>Больше примеров вы можете найти в описании <a href="https://github.com/github/fetch">полифилла для fetch</a>.</p><h2><a name="2" href="#2">Итого</a></h2><p>Метод <code>fetch</code> – уже сейчас удобная альтернатива <code>XMLHttpRequest</code> для тех, кто не хочет ждать и любит промисы.</p><p>Детальное описание этого метода есть в стандарте <a href="https://fetch.spec.whatwg.org/">Fetch</a>, а простейшие примеры запросов – в описании к <a href="https://github.com/github/fetch">полифиллу</a>.</p><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>! function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||screen.width<1024||"bannerBottomDisabled" in localStorage||(localStorage.bannerBottomShownCount||(localStorage.bannerBottomShownCount=1),document.querySelector(".banner-bottom").style.display="block")}();</script><nav-book data-tooltips="Атака CSRF; Таблица транспортов и их возможностей"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url="https:\/\/learn.javascript.ru\/fetch",disqus_identifier="fetch",disqus_title="\u041c\u0435\u0442\u043e\u0434 fetch: \u0437\u0430\u043c\u0435\u043d\u0430 XMLHttpRequest";</script></page-content></main>