<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="160">AJAX и COMET</a></nav-up><h1>Node.JS для решения задач</h1><p>В этом разделе предлагаются задачи по теме AJAX.</p><p>Конечно же, они требуют взаимодействия с сервером. Мы будем использовать серверную часть, написанную на JavaScript, на <a href="http://nodejs.org">Node.JS</a>.</p><p>Если вы не использовали Node.JS ранее – не беспокойтесь. Здесь нашей целью является преимущественно клиентская часть, поэтому прямо сейчас изучать Node.JS не обязательно. Серверные скрипты уже готовы. Нужно только поставить Node.JS и модули, чтобы их запускать.</p><h2><a name="0" href="#0">Установка</a></h2><p>Для настройки окружения будет достаточно сделать два шага:</p><ol><li><p>Сначала установите сам сервер Node.JS.</p><p>Если у вас Unix-система – рекомендуется собрать последнюю версию из исходников, а также NPM. Вы справитесь.</p><p>Если Windows – посетите сайт <a href="http://nodejs.org">http://nodejs.org</a> или скачайте установщик (32 или 64-битный) с расширением <code>.msi</code> из <a href="http://nodejs.org/dist/latest/">http://nodejs.org/dist/latest/</a>.</p></li><li><p>Выберите директорию, в которой будете решать задачи. Запустите в ней:</p><code-example><script>`npm install node-static`</script></code-example><p>Это установит в текущую директорию модуль <a href="https://github.com/cloudhead/node-static">node-static</a>, который станет автоматически доступным для скриптов из поддиректорий.</p><p><strong>Если у вас Windows и команда не сработала, то скорее всего дело в том, что «не подхватились» новые пути. Перезапустите ваш файловый менеджер или консоль.</strong></p></li></ol><h2><a name="1" href="#1">Проверка</a></h2><p>Проверьте инсталяцию.</p><p>Для этого:</p><ol><li><p>Создайте какую-нибудь поддиректорию и в ней файл <code>server.js</code> с таким содержимым:</p><code-example><script>`var http = require('http');\nvar static = require('node-static');\nvar file = new static.Server('.');\n\nhttp.createServer(function(req, res) {\n  file.serve(req, res);\n}).listen(8080);\n\nconsole.log('Server running on port 8080');`</script></code-example></li><li><p>Запустите его: <code>node server.js</code>.</p><p>Должно вывести:</p><code-example><script>`Server running on port 8080`</script></code-example></li></ol><important-warn><h3>Нельзя запустить больше одного сервера одновременно!</h3><p>При попытке запуска двух серверов (например, в разных консолях) – будет конфликт портов и ошибка.</p></important-warn><ol start="3"><li><p>Откройте в браузере <a href="http://127.0.0.1:8080/server.js">http://127.0.0.1:8080/server.js</a>.</p><p>Должно вывести код файла <code>server.js</code>.</p></li></ol><p>Если всё работает – отлично, теперь вы готовы решать задачи.</p><h2><a name="2" href="#2">Примеры</a></h2><p>В примерах, за редким исключением, для краткости будет приводиться не полный скрипт на Node.JS, а только код обработки запроса.</p><p>Например, вместо:</p><code-example><script>`var http = require('http');\nvar url = require('url');\nvar querystring = require('querystring');\n\nfunction accept(req, res) {\n\n  res.writeHead(200, {\n    'Content-Type': 'text/plain',\n    'Cache-Control': 'no-cache'\n  });\n\n  res.end("OK");\n}\n\nhttp.createServer(accept).listen(8080);`</script></code-example><p>…Будет только функция <code>accept</code>, или даже только её содержимое:</p><code-example><script>`res.writeHead(200, {\n  'Content-Type': 'text/plain',\n  'Cache-Control': 'no-cache'\n});`</script></code-example><h2><a name="3" href="#3">Основные методы</a></h2><p>В функции <code>accept</code> используются два объекта:</p><ul><li><code>req</code> – объект запроса («request»), то есть то, что прислал клиент (обычно браузер), из него читаем данные.</li><li><code>res</code> – объект ответа («response»), в него пишем данные в ответ клиенту.<ul><li>вызов <code>res.writeHead(HTTP-код, [строка статуса], {заголовки})</code> пишет заголовки.</li><li>вызов <code>res.write(txt)</code> пишет текст в ответ.</li><li>вызов <code>res.end(txt)</code> – завершает запрос ответом.</li></ul></li></ul><h2><a name="4" href="#4">Демо</a></h2><p>Кроме просмотра кода, можно будет попробовать и скачать различные демки.</p><p>Вот пример демо, можете попробовать нажать на кнопку – она работает.</p><figure- style="height: 50px;padding: 10px;"><code-download><a-></a-><a href="https://learn.javascript.ru/tutorial/zipview/example.zip?plunkId=SlaWzDdPQTTzsMO3QeQT" target="_blank" title="скачать архив" hover-style=""></a></code-download><button onclick="vote()" id="button">Голосовать</button><script>function vote(){button.innerHTML=" ... ";var t=new XMLHttpRequest;t.open("GET","vote",!0),t.onreadystatechange=function(){4 == t.readyState&&(200 == t.status ? button.innerHTML=t.responseText :alert("Ошибка "+t.status+": "+t.statusText))},t.send(null)}</script></figure-><p>Если хотите посмотреть пример поближе и поиграть с ним – скачайте архив (кнопка справа-сверху в примере выше), он будет работать и на вашем Node.JS.</p><h2><a name="5" href="#5">Больше о Node.JS</a></h2><p>Больше о сервере Node.JS можно узнать в <a data-load_page="c">скринкасте по Node.JS</a>.</p><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>! function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||screen.width<1024||"bannerBottomDisabled" in localStorage||(localStorage.bannerBottomShownCount||(localStorage.bannerBottomShownCount=1),document.querySelector(".banner-bottom").style.display="block")}();</script><nav-book data-tooltips="Введение в AJAX и COMET; Основы XMLHttpRequest"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url="https:\/\/learn.javascript.ru\/ajax-nodejs",disqus_identifier="ajax-nodejs",disqus_title="Node.JS \u0434\u043b\u044f \u0440\u0435\u0448\u0435\u043d\u0438\u044f \u0437\u0430\u0434\u0430\u0447";</script></page-content></main>