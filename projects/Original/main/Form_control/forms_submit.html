<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="98">Документ, события, интерфейсы</a><arrow-next></arrow-next><a data-load_page="140">Формы, элементы управления</a></nav-up><h1>Формы: отправка, событие и метод submit</h1><p>Событие <code>submit</code> возникает при отправке формы. Наиболее частое его применение – это <em>валидация</em> (проверка) формы перед отправкой.</p><p>Метод <code>submit</code> позволяет инициировать отправку формы из JavaScript, без участия пользователя. Далее мы рассмотрим детали их использования.</p><h2><a name="0" href="#0">Событие submit</a></h2><p>Чтобы отправить форму на сервер, у посетителя есть два способа:</p><ol><li><strong>Первый – это нажать кнопку <code>&lt;input type="submit"&gt;</code> или <code>&lt;input type="image"&gt;</code>.</strong></li><li><strong>Второй – нажать Enter, находясь на каком-нибудь поле.</strong></li></ol><p>Какой бы способ ни выбрал посетитель – будет сгенерировано событие <code>submit</code>. Обработчик в нём может проверить данные и, если они неверны, то вывести ошибку и сделать <code>event.preventDefault()</code> – тогда форма не отправится на сервер.</p><p>Например, в таком HTML оба способа выведут <code>alert</code>, форма не будет отправлена:</p><code-example><script>`<form onsubmit="alert('submit!');return false">\n  Первый: Enter в текстовом поле <input type="text" value="Текст"><br>\n  Второй: Нажать на "Отправить": <input type="submit" value="Отправить">\n</form>`</script><code-toolbar- iframe="80"><a title="показать" data-code_run=""></a><div></div></code-toolbar-></code-example><p>Ожидаемое поведение:</p><ol><li>Перейдите в текстовое поле и нажмите Enter, будет событие, но форма не отправится на сервер благодаря <code>return false</code> в обработчике.</li><li>То же самое произойдет при клике на <code>&lt;input type="submit"&gt;</code>.</li></ol><important-><h3>Взаимосвязь событий <code>submit</code> и <code>click</code></h3><p>При отправке формы путём нажатия Enter на текстовом поле, на элементе <code>&lt;input type="submit"&gt;</code> везде, кроме IE8-, генерируется событие <code>click</code>.</p><p>Это довольно забавно, учитывая что клика-то и не было.</p><code-example><script>`<form onsubmit="alert('submit');return false">\n <input type="text" size="30" value="При нажатии Enter будет click">\n <input type="submit" value="Submit" onclick="alert('click')">\n</form>`</script><code-toolbar- iframe="80"><a title="показать" data-code_run=""></a><div></div></code-toolbar-></code-example></important-><important-warn><h3>В IE8- событие <code>submit</code> не всплывает</h3><p>В IE8- событие <code>submit</code> не всплывает. Нужно вешать обработчик <code>submit</code> на сам элемент формы, без использования делегирования.</p></important-warn><h2><a name="1" href="#1">Метод submit</a></h2><p>Чтобы отправить форму на сервер из JavaScript – нужно вызвать на элементе формы метод <code>form.submit()</code>.</p><p>При этом само событие <code>submit</code> не генерируется. Предполагается, что если программист вызывает метод <code>form.submit()</code>, то он выполнил все проверки.</p><p>Это используют, в частности, для искусственной генерации и отправки формы.</p><h2 id="tasks"><a href="#2" name="2">Задачи (2)</a></h2><task-content><h3><a href="#5" name="5">Модальное диалоговое окно</a><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Создайте функцию <code>showPrompt(text, callback)</code>, которая выводит форму для ввода с сообщением <code>text</code> и кнопками <code>ОК/Отмена</code>.</p><ul><li>При отправке формы (OK/ввод в текстовом поле) – должна вызываться функция <code>callback</code> со значением поля.</li><li>При нажатии на <code>Отмена</code> или на клавишу <kbd class="shortcut">Esc</kbd> – должна вызываться функция <code>callback(null)</code>. Клавиша <kbd class="shortcut">Esc</kbd> должна закрывать форму всегда, даже если поле для ввода сообщения не в фокусе.</li></ul><p>Особенности реализации:</p><ul><li>Форма должна показываться в центре окна (и оставаться в центре при изменении его размеров, а также при прокрутке окна!).</li><li>Текст может состоять из нескольких строк, возможен любой HTML</li><li>При показе формы остальные элементы страницы использовать нельзя, не работают другие кнопки и т.п, это окно – <em>модальное</em>.</li><li>При показе формы – сразу фокус на <code>INPUT</code> для ввода.</li><li>Нажатия <kbd class="shortcut">Tab</kbd>/<kbd class="shortcut">Shift<span class="shortcut__plus">+</span>Tab</kbd> переключают в цикле только по полям формы, они не позволяют переключиться на другие элементы страницы.</li></ul><p>Пример использования:</p><code-example><script>`showPrompt("Введите что-нибудь<br>... умное :)", function(value) {\n  alert( value );\n});`</script></code-example><p>Демо:</p><figure- style="height:150px;overflow:auto;"><code-toolbar-><a id="answer_1" data-code_edit="" style="display:none"></a><a id="new_1" title="открыть в новом окне" data-new_window=""></a><a data-code_edit="?" title="открыть в песочнице" id="task_1"></a></code-toolbar-><style> #prompt-form{display:inline-block;padding:5px 5px 5px 70px;width:200px;border:1px solid black;background:white url(https://js.cx/clipart/prompt.png) no-repeat left 5px;vertical-align:middle;}#prompt-form-container{position:fixed;top:0;left:0;z-index:9999;display:none;width:100%;height:100%;text-align:center;}#prompt-form-container:before{display:inline-block;height:100%;content:'';vertical-align:middle;}#cover-div{position:fixed;top:0;left:0;z-index:9000;width:100%;height:100%;background-color:gray;opacity:0.3;}#prompt-form input[name="text"]{display:block;margin:5px;width:180px;}</style><div id="prompt" style="height:2000px;position:relative;"><h1>Нажмите на кнопку ниже</h1><input type="button" value="Нажмите для показа формы ввода" id="show-button"><div id="prompt-form-container" style="display: none;"><form id="prompt-form"><div id="prompt-message">Введите что-нибудь<br>...умное :)</div><input name="text" type="text"><input type="submit" value="Ок"><input type="button" name="cancel" value="Отмена"></form></div></div><script> /* Показать полупрозрачный DIV,затеняющий всю страницу (а форма будет не в нем,а рядом с ним,чтобы не полупрозрачная) */ function showCover(){var coverDiv=document.createElement('div');coverDiv.id='cover-div';document.body.appendChild(coverDiv);}function hideCover(){document.body.removeChild(document.getElementById('cover-div'));}function showPrompt(text,callback){showCover();var form=document.getElementById('prompt-form');var container=document.getElementById('prompt-form-container');document.getElementById('prompt-message').innerHTML=text;form.elements.text.value='';function complete(value){hideCover();container.style.display='none';document.onkeydown=null;callback(value);}form.onsubmit=function(){var value=form.elements.text.value;if (value == '') return false;/* игнорировать пустой submit */ complete(value);return false;};form.elements.cancel.onclick=function(){complete(null);};document.onkeydown=function(e){if (e.keyCode == 27){/* escape */ complete(null);}};var lastElem=form.elements[form.elements.length-1];var firstElem=form.elements[0];lastElem.onkeydown=function(e){if (e.keyCode == 9&&!e.shiftKey){firstElem.focus();return false;}};firstElem.onkeydown=function(e){if (e.keyCode == 9&&e.shiftKey){lastElem.focus();return false;}};container.style.display='block';form.elements.text.focus();}document.getElementById('show-button').onclick=function(){showPrompt("Введите что-нибудь<br>...умное :)",function(value){alert("Вы ввели: "+value);});};</script></figure-><p>Исходный HTML/CSS для формы с готовым fixed-позиционированием – в песочнице.</p><p><a data-click="task_1">Открыть песочницу для задачи.</a></p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Модальное окно делается путём добавления к документу <code>DIV</code>, полностью перекрывающего документ и имеющего больший <code>z-index</code>.</p><p>В результате все клики будут доставаться этому <code>DIV'у</code>:</p><p>Стиль:</p><code-example><script>`GOLD_#cover-div_GOLD {\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 9000;\n  width: 100%;\n  height: 100%;\n  background: gray;\n  opacity: 0.3;\n}`</script></code-example><p>Самой форме можно дать еще больший <code>z-index</code>, чтобы она была над <code>DIV'ом</code>. Мы не помещаем форму в контейнер, чтобы она не унаследовала полупрозрачность.</p><p><a data-click="answer_1">Открыть решение в песочнице.</a></p></task-answer></task-content><task-content><h3><a href="#6" name="6">Валидация формы</a><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 3</span><p>Напишите функцию <code>validate(form)</code>, которая проверяет содержимое формы по клику на кнопку «Проверить».</p><p>Ошибки:</p><ol><li>Одно из полей не заполнено.</li><li>Пароли не совпадают.</li></ol><p>Ошибка должна сопровождаться сообщением у поля. Например:</p><style>#validation tr{border:none}#validation span{margin:0 0 0 5px;color:red}</style><script>function resetForm(){let arr=validation.querySelectorAll('input');for (i=0,l=arr.length;i<l;i++){resetError(arr[i]);}resetError(validation.querySelector('select'));resetError(validation.querySelector('textarea'));validation.innerHTML=validation.innerHTML;}</script><figure- style="height:300px;padding:20px 10px;overflow:auto;font-family:serif;color:black;"><code-toolbar-><a title="form reset" onclick="resetForm()"></a><a id="new_2" title="открыть в новом окне" data-new_window=""></a><a id="answer_2" onclick="resetForm()" data-code_edit="" style="display:none"></a><a onclick="resetForm()" data-code_edit="?" title="открыть в песочнице" id="task_2"></a></code-toolbar-><style> #validation td select,#validation td input{width:150px;}#validation textarea{display:block;width:100%;max-width:400px;height:80px}#validation span{color:red;}</style><form id="validation" style="font-family:serif;color:black;"><table><tbody><tr><td>От кого</td><td><input name="from" type="text"></td></tr><tr><td>Ваш пароль</td><td><input name="password" type="password"></td></tr><tr><td>Повторите пароль</td><td><input name="password2" type="password"></td></tr><tr><td>Куда</td><td><select name="to"><option></option><option value="1">Отдел снабжения</option><option value="2">Отдел разработки</option><option value="3">Директору</option></select></td></tr></tbody></table>Сообщение: <label style="display:block;"><textarea name="message"></textarea></label><input type="button" onclick="validate(this.form)" value="Проверить"></form><script> function showError(elem,errorMessage){elem.style='border:1px solid red;';var msgElem=document.createElement('span');msgElem.innerHTML=errorMessage;elem.parentElement.appendChild(msgElem);}function resetError(el){el.removeAttribute('style');if (el.nextElementSibling){el.nextElementSibling.remove();}} function validate(form){var elems=form.elements;resetError(elems.from);if (!elems.from.value){showError(elems.from,' Укажите от кого.');}resetError(elems.password);if (!elems.password.value){showError(elems.password,' Укажите пароль.');}else if (elems.password.value != elems.password2.value){showError(elems.password,' Пароли не совпадают.');}resetError(elems.to);if (!elems.to.value){showError(elems.to,' Укажите, куда.');}resetError(elems.message);if (!elems.message.value){showError(elems.message,' Отсутствует текст.');}}</script></figure-><p><a data-click="task_2">Открыть песочницу для задачи.</a></p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p><a data-click="answer_2">Открыть решение в песочнице.</a></p></task-answer></task-content><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>! function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||screen.width<1024||"bannerBottomDisabled" in localStorage||(localStorage.bannerBottomShownCount||(localStorage.bannerBottomShownCount=1),document.querySelector(".banner-bottom").style.display="block")}();</script><nav-book data-tooltips="Изменение: change, input, cut, copy, paste; Создание графических компонентов"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url="https:\/\/learn.javascript.ru\/forms-submit",disqus_identifier="forms-submit",disqus_title="\u0424\u043e\u0440\u043c\u044b: \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430, \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0438 \u043c\u0435\u0442\u043e\u0434 submit";</script></page-content></main>