<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="98">Документ, события, интерфейсы</a><arrow-next></arrow-next><a data-load_page="128">События в деталях</a></nav-up><h1>Мышь: IE8-, исправление события</h1><p>Ранее мы говорили о различных несовместимостях при работе с событиями для IE8-. Самая главная – это, конечно, назначение событий при помощи <code>attachEvent/detachEvent</code> вместо <code>addEventListener/removeEventListener</code> и отсутствие фазы перехвата. Но и в самом объекте события есть различия.</p><p>Что касается событий мыши, различия в свойствах можно легко исправить при помощи функции <code>fixEvent</code>, которая описана в этой главе.</p><important-warn><h3>Только IE8-</h3><p>Эта глава и описанная далее функция <code>fixEvent</code> нужны только для поддержки IE8-.</p><p>Если IE8- для Вас неактуален, то пролистывайте дальше, это читать Вам не надо.</p></important-warn><p>Функция <code>fixEvent</code> предназначена для запуска в начале обработчика, вот так:</p><code-example><script>`elem.onclick = function(event) {\nMARK  // если IE8-, то получить объект события window.event и исправить его\nMARK  event = event || fixEvent.call(this, window.event);\n  ...\n}`</script></code-example><p>Она добавит объекту события в IE8- следующие стандартные свойства:</p><ul><li><code>target</code></li><li><code>currentTarget</code> – если обработчик назначен не через <code>attachEvent</code>.</li><li><code>relatedTarget</code> – для <code>mouseover/mouseout</code> и <code>mouseenter/mouseleave</code>.</li><li><code>pageX/pageY</code></li><li><code>which</code></li></ul><p>Код функции:</p><code-example><script>`function fixEvent(e) {\n\n  e.currentTarget = this;\n  e.target = e.srcElement;\n\n  if (e.type == 'mouseover' || e.type == 'mouseenter') e.relatedTarget = e.fromElement;\n  if (e.type == 'mouseout' || e.type == 'mouseleave') e.relatedTarget = e.toElement;\n\n  if (e.pageX == null && e.clientX != null) {\n    var html = document.documentElement;\n    var body = document.body;\n\n    e.pageX = e.clientX + (html.scrollLeft || body && body.scrollLeft || 0);\n    e.pageX -= html.clientLeft || 0;\n\n    e.pageY = e.clientY + (html.scrollTop || body && body.scrollTop || 0);\n    e.pageY -= html.clientTop || 0;\n  }\n\n  if (!e.which && e.button) {\n    e.which = e.button & 1 ? 1 : (e.button & 2 ? 3 : (e.button & 4 ? 2 : 0));\n  }\n\n  return e;\n}`</script></code-example><p>Эта функция может быть полезна, если не используются JavaScript-фреймворки, в которых есть свои средства сглаживания кросс-браузерных различий.</p><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>!function () { /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || screen.width < 1024 || "bannerBottomDisabled" in localStorage || (localStorage.bannerBottomShownCount || (localStorage.bannerBottomShownCount = 1), document.querySelector(".banner-bottom").style.display = "block") }();</script><nav-book data-tooltips="Мышь: колёсико, событие wheel; Прокрутка: событие scroll"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url = "https:\/\/learn.javascript.ru\/fixevent", disqus_identifier = "fixevent", disqus_title = "\u041c\u044b\u0448\u044c: IE8-, \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f";</script></page-content></main>