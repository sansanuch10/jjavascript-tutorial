<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="98">Документ, события, интерфейсы</a><arrow-next></arrow-next><a data-load_page="128">События в деталях</a></nav-up><h1>Мышь: колёсико, событие wheel</h1><p>Колёсико мыши используется редко. Оно есть даже не у всех мышей. Поэтому существуют пользователи, которые в принципе не могут сгенерировать такое событие.</p><p>…Но, тем не менее, его использование может быть оправдано. Например, можно добавить дополнительные удобства для тех, у кого колёсико есть.</p><h2><a name="0" href="#0">Отличия колёсика от прокрутки</a></h2><p>Несмотря на то, что колёсико мыши обычно ассоциируется с прокруткой, это совсем разные вещи.</p><ul><li>При прокрутке срабатывает событие <a data-load_page="136">onscroll</a> – рассмотрим его в дальнейшем. Оно произойдёт <em>при любой прокрутке</em>, в том числе через клавиатуру, но <em>только на прокручиваемых элементах</em>. Например, элемент с <code>overflow:hidden</code> в принципе не может сгенерировать <code>onscroll</code>.</li><li>А событие <code>wheel</code> является чисто «мышиным». Оно генерируется <em>над любым элементом</em> при передвижении колеса мыши. При этом не важно, прокручиваемый он или нет. В частности, <code>overflow:hidden</code> никак не препятствует обработке колеса мыши.</li></ul><p>Кроме того, событие <code>onscroll</code> происходит <em>после</em> прокрутки, а <code>onwheel</code> – <em>до</em> прокрутки, поэтому в нём можно отменить саму прокрутку (действие браузера).</p><h2><a name="1" href="#1">Зоопарк wheel в разных браузерах</a></h2><p>Событие <code>wheel</code> появилось в <a href="http://www.w3.org/TR/DOM-Level-3-Events/#event-type-wheel">стандарте</a> не так давно. Оно поддерживается Chrome 31+, IE9+, Firefox 17+.</p><p>До него браузеры обрабатывали прокрутку при помощи событий <a href="http://msdn.microsoft.com/en-us/library/ie/ms536951.aspx">mousewheel</a> (все кроме Firefox) и <a href="https://developer.mozilla.org/en-US/docs/DOM/DOM_event_reference/DOMMouseScroll">DOMMouseScroll</a>, <a href="https://developer.mozilla.org/en-US/docs/DOM/DOM_event_reference/MozMousePixelScroll">MozMousePixelScroll</a> (только Firefox).</p><p>Самые важные свойства современного события и его нестандартных аналогов:</p><dl><dt><code>wheel</code></dt><dd>Свойство <code>deltaY</code> – количество прокрученных пикселей по вертикали. Существуют также свойства <code>deltaX</code> и <code>deltaZ</code> для других направлений прокрутки.</dd><dt><code>MozMousePixelScroll</code></dt><dd>Срабатывает, начиная с Firefox 3.5, только в Firefox. Даёт возможность отменить прокрутку и получить размер в пикселях через свойство <code>detail</code>, ось прокрутки в свойстве <code>axis</code>.</dd><dt></dt><dt><code>mousewheel</code></dt><dd>Срабатывает в браузерах, которые ещё не реализовали <code>wheel</code>. В свойстве <code>wheelDelta</code> – условный «размер прокрутки», обычно равен <code>120</code> для прокрутки вверх и <code>-120</code> – вниз. Он не соответствует какому-либо конкретному количеству пикселей.</dd></dl><p>Чтобы кросс-браузерно отловить прокрутку и, при необходимости, отменить её, можно использовать все эти события.</p><p>Пример, включающий поддержку IE8-:</p><code-example><script>`if (elem.addEventListener) {\n  if ('onwheel' in document) {\n    // IE9+, FF17+, Ch31+\n    elem.addEventListener("wheel", onWheel);\n  } else if ('onmousewheel' in document) {\n    // устаревший вариант события\n    elem.addEventListener("mousewheel", onWheel);\n  } else {\n    // Firefox < 17\n    elem.addEventListener("MozMousePixelScroll", onWheel);\n  }\n} else { // IE8-\n  elem.attachEvent("onmousewheel", onWheel);\n}\n\nfunction onWheel(e) {\n  e = e || window.event;\n\n  // wheelDelta не дает возможность узнать количество пикселей\n  var delta = e.deltaY || e.detail || e.wheelDelta;\n\n  var info = document.getElementById('delta');\n\n  info.innerHTML = +info.innerHTML + delta;\n\n  e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n}`</script></code-example><p>В действии:</p><figure-><code-toolbar-><div></div><a title="открыть в новом окне" data-new_window=""></a><a title="открыть в песочнице" data-code_edit=""></a></code-toolbar-><style> #container{width:200px;height:200px;border:1px solid black;background:#0FF;overflow:auto;}</style> Прокрутка: <span id="delta">0</span><div id="container"> Прокрути надо мной. </div><script>var elem=document.getElementById('container');if (elem.addEventListener){if ('onwheel' in document){/* IE9+,FF17+ */ elem.addEventListener("wheel",onWheel);}else if ('onmousewheel' in document){elem.addEventListener("mousewheel",onWheel);/* устаревший вариант события */}else{elem.addEventListener("MozMousePixelScroll",onWheel);/* Firefox<17*/}} else{/* IE8- */ elem.attachEvent("onmousewheel",onWheel);}function onWheel(e){/* Это решение предусматривает поддержку IE8- */ e=e||window.event;var delta=e.deltaY||e.detail||e.wheelDelta;/* deltaY,detail содержат пиксели,wheelDelta не дает возможность узнать количество пикселей */ var info=document.getElementById('delta');info.innerHTML=+info.innerHTML+delta;e.preventDefault ? e.preventDefault() :(e.returnValue=false);}</script></figure-><important-warn><h3>Ошибка в IE8</h3><p>В браузере IE8 (только версия 8) есть ошибка. При наличии обработчика <code>mousewheel</code> – элемент не скроллится. Иначе говоря, действие браузера отменяется по умолчанию.</p><p>Это, конечно, не имеет значения, если элемент в принципе не прокручиваемый.</p></important-warn><h2 id="tasks"><a href="#2" name="2">Задачи (2)</a></h2><task-content><h3><a href="#5" name="5">Масштабирование колёсиком мыши</a><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Сделайте так, чтобы при прокрутке колёсиком мыши над элементом, он масштабировался.</p><p>Масштабирование обеспечивайте при помощи свойства CSS transform:</p><code-example><script>`// увеличение в 1.5 раза\nelem.style.transform = elem.style.WebkitTransform = elem.style.MsTransform = 'scale(1.5)';`</script></code-example><p>Результат в iframe:</p><figure-><code-toolbar-><a id="answer_1" title="открыть в песочнице" data-code_edit="" style="display:none"></a><a title="открыть в новом окне" data-new_window=""></a><a id="task_1" title="открыть в песочнице" data-code_edit="?"></a></code-toolbar-><p id="text" style="margin: 40px; width: 200px; height: 60px; border: 1px solid red; transform: scale(1);"> При прокрутке колёсика мыши над этим элементом, он будет масштабироваться.</p><script> function addOnWheel(elem,handler){if (elem.addEventListener){if ('onwheel' in document){elem.addEventListener("wheel",handler);/* IE9+,FF17+ */}else if ('onmousewheel' in document){elem.addEventListener("mousewheel",handler);/* устаревший вариант события */}else{/* 3.5 <= Firefox<17,более старое событие DOMMouseScroll пропустим */ elem.addEventListener("MozMousePixelScroll",handler);}} else{/* IE8- */ text.attachEvent("onmousewheel",handler);}} var scale=1;addOnWheel(text,function(e){var delta=e.deltaY||e.detail||e.wheelDelta;if (delta>0) scale += 0.05;/* отмасштабируем при помощи CSS */ else scale -= 0.05;text.style.transform=text.style.WebkitTransform=text.style.MsTransform='scale('+scale+')';e.preventDefault();/* отменим прокрутку */});</script></figure-><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Решение использует кросс-браузерный код назначения обработчика <code>onwheel</code> на элемент и <code>style.transform</code>.</p><p><a data-click="answer_1">Открыть решение в песочнице.</a></p></task-answer></task-content><task-content><h3><a href="#6" name="6">Прокрутка без влияния на страницу</a><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 4</span><p>В большинстве браузеров если в процессе прокрутки <code>textarea</code> колёсиком мышки (или жестами) мы достигаем границы элемента, то прокрутка продолжается уже на уровне страницы (в Firefox при этом будет небольшая задержка перед продолжением прокрутки).</p><p>Иными словами, если в примере ниже вы попробуете прокрутить <code>textarea</code> вниз, то когда прокрутка дойдёт до конца – начнёт прокручиваться документ:</p><figure- style="height: 300px;overflow: auto;"><div style="height: 1000px;padding: 0 30px;"><header><b style="font-size:24px;margin:10px">Начало документа</b></header><pre style="overflow: auto;height: 150px;border: 1px solid lightgray;"> 
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
</pre><footer> Конец документа. </footer></div></figure-><p>То же самое происходит при прокрутке вверх.</p><p>В интерфейсах редактирования, когда большая <code>textarea</code> является основным элементом страницы, такое поведение может быть неудобно.</p><p>Для редактирования более оптимально, чтобы при прокрутке до конца <code>textarea</code> страница не «улетала» вверх и вниз.</p><p>Вот тот же документ, но с желаемым поведением <code>textarea</code>:</p><figure- style="height: 300px;overflow: auto;"><code-toolbar-><a id="answer_2" data-code_edit="" style="display:none"></a><a id="task_2" data-code_edit="?" title="редактировать в песочнице"></a></code-toolbar-><div style="height: 1000px;padding: 0 30px;"><header><b style="font-size:24px;margin:10px">Начало документа</b></header><pre id="no_scroll" style="overflow: auto;height: 150px;border: 1px solid lightgray;"> 
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
    прокрути меня
</pre><footer> Конец документа. </footer></div><script>document.onwheel=function(e){if (e.target.id != 'no_scroll') return;var area=e.target;var delta=e.deltaY||e.detail||e.wheelDelta;if (delta<0&&area.scrollTop == 0){e.preventDefault();}if (delta>0&&area.scrollHeight-area.clientHeight-area.scrollTop <= 1){e.preventDefault();}};</script></figure-><p>Задача:</p><ul><li>Создать скрипт, который при подключении к документу исправлял бы поведение всех <code>textarea</code>, чтобы при прокрутке они не трогали документ.</li><li>Направление прокрутки – только вверх или вниз.</li><li>Редактор прокручивает только мышкой или жестами (на мобильных устройствах), прокрутку клавиатурой здесь рассматривать не нужно (хотя это и возможно).</li></ul><p><a data-click="task_2">Открыть песочницу для задачи.</a></p><button-answer data-toggle_answer="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p><a data-click="answer_2">Открыть решение в песочнице.</a></p></task-answer></task-content><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>! function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||screen.width<1024||"bannerBottomDisabled" in localStorage||(localStorage.bannerBottomShownCount||(localStorage.bannerBottomShownCount=1),document.querySelector(".banner-bottom").style.display="block")}();</script><nav-book data-tooltips="Мышь: Drag'n'Drop более глубоко; Мышь: IE8-, исправление события"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url="https:\/\/learn.javascript.ru\/mousewheel",disqus_identifier="mousewheel",disqus_title="\u041c\u044b\u0448\u044c: \u043a\u043e\u043b\u0451\u0441\u0438\u043a\u043e, \u0441\u043e\u0431\u044b\u0442\u0438\u0435 wheel";</script></page-content></main>