<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="98">Документ, события, интерфейсы</a><arrow-next></arrow-next><a data-load_page="128">События в деталях</a></nav-up><h1>Мышь: отмена выделения, невыделяемые элементы</h1><p>У кликов мыши есть неприятная особенность.</p><p>Двойной клик или нажатие с движением курсора как правило инициируют выделение текста.</p><p>Если мы хотим обрабатывать эти события сами, то такое выделение – некрасиво и неудобно. В этой главе мы рассмотрим основные способы, как делать элемент невыделяемым.</p><p>Для полноты картины, среди них будут и такие, которые применимы не только к событиям мыши.</p><h2><a name="0" href="#0">Способ 1: отмена mousedown/selectstart</a></h2><p>Проблема: браузер выделяет текст при движении мышью с зажатой левой кнопкой , а также при двойном клике на элемент. Даже там, где это не нужно.</p><p>Если сделать двойной клик на таком элементе, то обработчик сработает. Но побочным эффектом является <em>выделение текста браузером</em>.</p><code-example><script>`<span BLUE_ondblclick_BLUE="alert('двойной клик!')">Текст</span>`</script><code-toolbar- iframe="60"><a title="показать" data-code_run=""></a><div></div></code-toolbar-></code-example><p>Чтобы избежать выделения, мы должны предотвратить действие браузера по умолчанию для события <a href="http://msdn.microsoft.com/en-us/library/ms536969%28VS.85%29.aspx">selectstart</a> в IE и <code>mousedown</code> в других браузерах.</p><p>Полный код элемента, который обрабатывает двойной клик без выделения:</p><code-example><script>`<div BLUE_ondblclick_BLUE="alert('Тест')" BLUE_onselectstart_BLUE="return false" BLUE_onmousedown_BLUE="return false">\n  Двойной клик сюда выведет "Тест", без выделения\n</div>`</script><code-toolbar- iframe="60"><a title="показать" data-code_run=""></a><div></div></code-toolbar-></code-example><p>При установке на родителя – все его потомки станут невыделяемыми:</p><code-example><script>`Элементы списка не выделяются при клике:\n<ul BLUE_onmousedown_BLUE="return false" BLUE_onselectstart_BLUE="return false">\n  <li>Винни-Пух</li>\n  <li>Ослик Иа</li>\n  <li>Мудрая Сова</li>\n  <li>Кролик. Просто кролик.</li>\n</ul>`</script><code-toolbar- iframe="135"><a title="показать" data-code_run=""></a><div></div></code-toolbar-></code-example><important-><h3>Выделение, всё же, возможно</h3><p>Отмена действия браузера при <code>mousedown/selectstart</code> отменяет выделение при клике, но не запрещает его полностью.</p><p>Если пользователь всё же хочет выделить текстовое содержимое элемента, то он может сделать это.</p><p>Достаточно начать выделение (зажать кнопку мыши) не на самом элементе, а рядом с ним. Ведь там отмены не произойдёт, выделение начнётся, и дальше можно передвинуть мышь уже на элемент.</p></important-><h2><a name="1" href="#1">Способ 2: снятие выделения пост-фактум</a></h2><p>Вместо <em>предотвращения</em> выделения, можно его снять в обработчике события, <em>после</em> того, как оно уже произошло.</p><p>Для этого мы используем методы работы с выделением, которые описаны в отдельной главе <a data-load_page="239">Выделение: Range, TextRange и Selection</a>. Здесь нам понадобится всего лишь одна функция <code>clearSelection</code>, которая будет снимать выделение.</p><p>Пример со снятием выделения при двойном клике на элемент списка:</p><code-example><script>`<ul>\n  <li BLUE_ondblclick_BLUE="clearSelection()">Выделение отменяется при двойном клике.</li>\n</ul>\n\n<script>\n  function clearSelection() {\n    if (window.getSelection) {\n      window.getSelection().removeAllRanges();\n    } else { // старый IE\n      document.selection.empty();\n    }\n  }\n<\/script>`</script><code-toolbar- iframe="60"><a title="показать" data-code_run=""></a><div></div></code-toolbar-></code-example><p>У этого подхода есть две особенности, на которые стоит обратить внимание:</p><ul><li>Выделение всё же производится, но тут же снимается. Это выглядит как мигание и не очень красиво.</li><li>Выделение при помощи передвижения зажатой мыши всё еще работает, так что посетитель имеет возможность выделить содержимое элемента.</li></ul><h2><a name="2" href="#2">Способ 3: свойство user-select</a></h2><p>Существует нестандартное CSS-свойство <code>user-select</code>, которое делает элемент невыделяемым.</p><p>Оно когда-то планировалось в стандарте CSS3, потом от него отказались, но поддержка в браузерах уже была сделана и потому осталась.</p><p>Это свойство работает (с префиксом) везде, кроме IE9-:</p><code-example><script>`<style>\n  GOLD_b_GOLD {\n    BLUE_-webkit-user-select_BLUE: none;\n    /* user-select -- это нестандартное свойство */\n\n    BLUE_-moz-user-select_BLUE: none;\n    /* поэтому нужны префиксы */\n\n    BLUE_-ms-user-select_BLUE: none;\n  }\n</style>\n\nСтрока до..\n<div BLUE_ondblclick_BLUE="alert('Тест')">\n  <b>Этот текст нельзя выделить (кроме IE9-)</b>\n</div>\n.. Строка после`</script><code-toolbar- iframe="75"><a title="показать" data-code_run=""></a><div></div></code-toolbar-></code-example><p>Читайте на эту тему также <a href="http://blogs.msdn.com/b/ie/archive/2012/01/11/controlling-selection-with-css-user-select.aspx">Controlling Selection with CSS user-select</a>.</p><h3><a name="6" href="#6">IE9-: атрибут unselectable=«on»</a></h3><p>В IE9- нет <code>user-select</code>, но есть атрибут <a href="http://msdn.microsoft.com/en-us/library/ms534706%28v=vs.85%29.aspx">unselectable</a>.</p><p>Он отменяет выделение, но у него есть особенности:</p><ol><li>Во-первых, невыделяемость не наследуется. То есть, невыделяемость родителя не делает невыделяемыми детей.</li><li>Во-вторых, текст, в отличие от <code>user-select</code>, всё равно можно выделить, если начать выделение не на самом элементе, а рядом с ним.</li></ol><code-example><script>`<div BLUE_ondblclick_BLUE="alert('Тест')" HIGHBLUE_unselectable_BLUE="on"LIGHT style="border:1px solid black">\n  Этот текст невыделяем в IE, <RED_em_RED>кроме дочерних элементов</RED_em_RED>\n</div>`</script></code-example><p>Левая часть текста в IE не выделяется при двойном клике. Правую часть (<code>em</code>) можно выделить, т.к. на ней нет атрибута <code>unselectable</code>.</p><p>В действии:</p><div ondblclick="alert('Тест')" unselectable="on" style="border:1px solid black"> Этот текст невыделяем в IE, <em>кроме дочерних элементов</em></div><h2><a name="3" href="#3">Итого</a></h2><p>Для отмены выделения есть несколько способов:</p><ol><li><p>CSS-свойство <code>user-select</code> – везде кроме IE9- (нужен префикс, нестандарт).</p></li><li><p>Атрибут <code>unselectable="on"</code> – работает для любых IE (должен быть у всех потомков)</p></li><li><p>Отмена действий на <code>mousedown</code> и <code>selectstart</code>:</p><code-example><script>`elem.onmousedown = elem.onselectstart = function() {\n  return false;\n};`</script></code-example></li><li><p>Отмена выделения пост-фактум через функцию <code>clearSelection()</code>, описанную выше.</p></li></ol><p>Какой же способ выбирать?</p><p>Это зависит от задач и вашего удобства, а также конкретного случая. Все описанные способы работают.</p><p>Недостаток <code>user-select</code> – в том, что посетитель теряет возможность скопировать текст. А что, если он захочет именно это сделать?</p><p>В любом случае эти способы не предназначены для защиты от выделения-и-копирования.</p><p>Если уж хочется запретить копирование – можно использовать событие <code>oncopy</code>:</p><code-example><script>`<div BLUE_oncopy_BLUE="alert('Копирование запрещено');return false">\n  Уважаемый копирователь,\n  почему-то автор хочет заставить вас покопаться в исходном коде этой страницы.\n  Если вы знаете JS или HTML, то скопировать текст не составит для вас проблемы,\n  ну а если нет, то увы...\n</div>`</script><code-toolbar- iframe="60"><a title="показать" data-code_run=""></a><div></div></code-toolbar-></code-example><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>! function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||screen.width<1024||"bannerBottomDisabled" in localStorage||(localStorage.bannerBottomShownCount||(localStorage.bannerBottomShownCount=1),document.querySelector(".banner-bottom").style.display="block")}();</script><nav-book data-tooltips="Мышь: клики, кнопка, координаты; Мышь: движение mouseover/out, mouseenter/leave"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url="https:\/\/learn.javascript.ru\/unselectable",disqus_identifier="unselectable",disqus_title="\u041c\u044b\u0448\u044c: \u043e\u0442\u043c\u0435\u043d\u0430 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u044f, \u043d\u0435\u0432\u044b\u0434\u0435\u043b\u044f\u0435\u043c\u044b\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b";</script></page-content></main>