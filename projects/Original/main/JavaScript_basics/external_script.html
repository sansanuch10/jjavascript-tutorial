<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="1">Язык JavaScript</a><arrow-next></arrow-next><a data-load_page="7">Основы JavaScript</a></nav-up><h1>Внешние скрипты, порядок исполнения</h1><p>Если JavaScript-кода много – его выносят в отдельный файл, который подключается в HTML:</p><code-example><script>`<script src="/path/to/script.js"><\/script>`</script></code-example><p>Здесь <code>/path/to/script.js</code> – это абсолютный путь к файлу, содержащему скрипт (из корня сайта).</p><p>Браузер сам скачает скрипт и выполнит.</p><p>Можно указать и полный URL, например:</p><code-example><script>`<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.3.0/lodash.js"><\/script>`</script></code-example><p>Вы также можете использовать путь относительно текущей страницы. Например, <code>src="lodash.js"</code> обозначает файл из текущей директории.</p><p>Чтобы подключить несколько скриптов, используйте несколько тегов:</p><code-example><script>`<script src="/js/script1.js"><\/script>\n<script src="/js/script2.js"><\/script>\n...`</script></code-example><important-><h3>На заметку:</h3><p>Как правило, в HTML пишут только самые простые скрипты, а сложные выносят в отдельный файл.</p><p>Браузер скачает его только первый раз и в дальнейшем, при правильной настройке сервера, будет брать из своего  <a href="http://ru.wikipedia.org/wiki/%D0%9A%D1%8D%D1%88">кеша</a>.</p><p>Благодаря этому один и тот же большой скрипт, содержащий, к примеру, библиотеку функций, может использоваться  на разных страницах без полной перезагрузки с сервера.</p></important-><important-warn><h3>Если указан атрибут  <code>src</code>, то содержимое тега игнорируется.</h3><p>В одном теге  <code>SCRIPT</code> нельзя одновременно подключить внешний скрипт и указать код.</p><p>Вот так не сработает:</p><code-example><script>`<script HIGHsrcLIGHT="file.js">\n  alert(1); // так как указан src, то внутренняя часть тега игнорируется\n<\/script>`</script></code-example><p>Нужно выбрать: либо  <code>SCRIPT</code> идёт с  <code>src</code>, либо содержит код. Тег выше следует разбить на два: один – с  <code>src</code>, другой – с кодом, вот так:</p><code-example><script>`<script src="file.js"><\/script>\n<script>\n  alert( 1 );\n<\/script>`</script></code-example></important-warn><h2><a name="a" href="#a">Асинхронные скрипты: defer/async</a></h2><p>Браузер загружает и отображает HTML постепенно. Особенно это заметно при медленном интернет-соединении: браузер не ждёт, пока страница загрузится целиком, а показывает ту часть, которую успел загрузить.</p><p>Если браузер видит тег <code>&lt;script&gt;</code>, то он по стандарту обязан сначала выполнить его, а потом показать оставшуюся часть страницы.</p><p>Например, в примере ниже – пока все кролики не будут посчитаны – нижний <code>&lt;p&gt;</code> не будет показан:</p><code-example><script>`<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset="utf-8">\n</head>\n\n<body>\n\n  <p>Начинаем считать:</p>\n\n  <script>\n    alert( \'Первый кролик!\' );\n    alert( \'Второй кролик!\' );\n    alert( \'Третий кролик!\' );\n  <\/script>\n\n  <p>Кролики посчитаны!</p>\n\n</body>\n\n</html>`</script><code-toolbar></code-toolbar></code-example><p>Такое поведение называют «синхронным». Как правило, оно вполне нормально, но есть важное следствие.</p><p><strong>Если скрипт – внешний, то пока браузер не выполнит его, он не покажет часть страницы под ним.</strong></p><p>То есть, в таком документе, пока не загрузится и не выполнится <code>big.js</code>, содержимое <code>&lt;body&gt;</code> будет скрыто:</p><code-example><script>`<html>\n<head>\nMARK  <script src="big.js"><\/script>\n</head>\n<body>\n  Этот текст не будет показан, пока браузер не выполнит big.js.\n</body>\n</html>`</script></code-example><p>И здесь вопрос – действительно ли мы этого хотим? То есть, действительно ли оставшуюся часть страницы нельзя показывать до загрузки скрипта?</p><p>Есть ситуации, когда мы не только НЕ хотим такой задержки, но она даже опасна.</p><p>Например, если мы подключаем внешний скрипт, который показывает рекламу или вставляет счётчик посещений, а затем идёт наша страница. Конечно, неправильно, что пока счётчик или реклама не подгрузятся – оставшаяся часть страницы не показывается. Счётчик посещений не должен никак задерживать отображение страницы сайта. Реклама тоже не должна тормозить сайт и нарушать его функциональность.</p><p>А что, если сервер, с которого загружается внешний скрипт, перегружен? Посетитель в этом случае может ждать очень долго!</p><p>Вот пример, с подобным скриптом (стоит искусственная задержка загрузки):</p><code-example><script>`<p>Важная информация не покажется, пока не загрузится скрипт.</p>\n\n<script src="https://js.cx/hello/ads.js?speed=0"><\/script>\n\n<p>...Важная информация!</p>`</script><code-toolbar iframe="100"></code-toolbar></code-example><p>Что делать?</p><p>Можно поставить все подобные скрипты в конец страницы – это уменьшит проблему, но не избавит от неё полностью, если скриптов несколько. Допустим, в конце страницы 3 скрипта, и первый из них тормозит – получается, другие два его будут ждать – тоже нехорошо.</p><p>Кроме того, браузер дойдёт до скриптов, расположенных в конце страницы, они начнут грузиться только тогда, когда вся страница загрузится. А это не всегда правильно. Например, счётчик посещений наиболее точно сработает, если загрузить его пораньше.</p><p>Поэтому «расположить скрипты внизу» – не лучший выход.</p><p>Кардинально решить эту проблему помогут атрибуты <code>async</code> или <code>defer</code>:</p><b>Атрибут   <code>async</code></b><p>Поддерживается всеми браузерами, кроме IE9-. Скрипт выполняется полностью асинхронно. То есть, при обнаружении <code>&lt;script async src="..."&gt;</code> браузер не останавливает обработку страницы, а спокойно работает дальше. Когда скрипт будет загружен – он выполнится.</p><b>Атрибут   <code>defer</code></b><p>Поддерживается всеми браузерами, включая самые старые IE. Скрипт также выполняется асинхронно, не заставляет ждать страницу, но есть два отличия от <code>async</code>.</p><p>Первое – браузер гарантирует, что относительный порядок скриптов с <code>defer</code> будет сохранён.</p><p>То есть, в таком коде (с <code>async</code>) первым сработает тот скрипт, который раньше загрузится:</p><code-example><script>`<script src="1.js" async><\/script>\n<script src="2.js" async><\/script>`</script></code-example><p>А в таком коде (с <code>defer</code>) первым сработает всегда <code>1.js</code>, а скрипт <code>2.js</code>, даже если загрузился раньше, будет его ждать.</p><code-example><script>`<script src="1.js" defer><\/script>\n<script src="2.js" defer><\/script>`</script></code-example><p>Поэтому атрибут <code>defer</code> используют в тех случаях, когда второй скрипт <code>2.js</code> зависит от первого <code>1.js</code>, к примеру – использует что-то, описанное первым скриптом.</p><p>Второе отличие – скрипт с <code>defer</code> сработает, когда весь HTML-документ будет обработан браузером.</p><p>Например, если документ достаточно большой…</p><code-example><script>`<script src="async.js" async><\/script>\n<script src="defer.js" defer><\/script>\n\nМного много много букв.`</script></code-example><p>…То скрипт <code>async.js</code> выполнится, как только загрузится – возможно, до того, как весь документ готов. А <code>defer.js</code> подождёт готовности всего документа.</p><p>Это бывает удобно, когда мы в скрипте хотим работать с документом, и должны быть уверены, что он полностью получен.</p><important-><h3>  <code>async</code> вместе с  <code>defer</code></h3><p>При одновременном указании  <code>async</code> и  <code>defer</code> в современных браузерах будет использован только  <code>async</code>, в IE9- – только  <code>defer</code> (не понимает  <code>async</code>).</p></important-><important-warn><h3>Атрибуты  <code>async/defer</code> – только для внешних скриптов</h3><p>Атрибуты  <code>async/defer</code> работают только в том случае, если назначены на внешние скрипты, т.е. имеющие  <code>src</code>.</p><p>При попытке назначить их на обычные скрипты  <code>&lt;script&gt;…&lt;/script&gt;</code>, они будут проигнорированы.</p></important-warn><p>Тот же пример с <code>async</code>:</p><code-example><script>`<p>Важная информация теперь не ждёт, пока загрузится скрипт...</p>\n\n<script async src="https://js.cx/hello/ads.js?speed=0"><\/script>\n\n<p>...Важная информация!</p>`</script><code-toolbar iframe="100"></code-toolbar></code-example><p>При запуске вы увидите, что вся страница отобразилась тут же, а <code>alert</code> из внешнего скрипта появится позже, когда загрузится скрипт.</p><important-><h3>Эти атрибуты давно «в ходу»</h3><p>Большинство современных систем рекламы и счётчиков знают про эти атрибуты и используют их.</p><p>Перед вставкой внешнего тега  <code>&lt;script&gt;</code> понимающий программист всегда проверит, есть ли у него подобный атрибут. Иначе медленный скрипт может задержать  загрузку страницы.</p></important-><important-><h3>Забегая вперёд</h3><p>Для продвинутого читателя, который знает, что теги  <code>&lt;script&gt;</code> можно добавлять на страницу в любой момент при помощи самого javascript, заметим, что скрипты, добавленные  таким образом, ведут себя так же, как  <code>async</code>. То есть, выполняются как только загрузятся, без сохранения относительного порядка.</p><p>Если же нужно сохранить порядок выполнения, то есть добавить несколько скриптов, которые выполнятся строго один  за другим, то используется свойство  <code>script.async = false</code>.</p><p>Выглядит это примерно так:</p><code-example><script>`function addScript(src){\n  var script = document.createElement(\'script\');\n  script.src = src;\n  script.async = false; // чтобы гарантировать порядок\n  document.head.appendChild(script);\n}\n\naddScript(\'1.js\'); // загружаться эти скрипты начнут сразу\naddScript(\'2.js\'); // выполнятся, как только загрузятся\naddScript(\'3.js\'); // но, гарантированно, в порядке 1 -> 2 -> 3`</script></code-example><p>Более подробно работу со страницей мы разберём во второй части учебника.</p></important-><h2><a name="b" href="#b">Итого</a></h2><ul><li>Скрипты вставляются на страницу как текст в теге  <code>&lt;script&gt;</code>, либо как внешний файл через  <code>&lt;script src="путь"&gt;&lt;/script&gt;</code></li><li>Специальные атрибуты  <code>async</code> и  <code>defer</code> используются для того, чтобы пока грузится внешний скрипт – браузер показал остальную (следующую за ним)  часть страницы. Без них этого не происходит.</li><li>Разница между  <code>async</code> и  <code>defer</code>: атрибут  <code>defer</code> сохраняет относительную последовательность скриптов, а  <code>async</code> – нет. Кроме того,  <code>defer</code> всегда ждёт, пока весь HTML-документ будет готов, а  <code>async</code> – нет.</li></ul><p>Очень важно не только читать учебник, но делать что-то самостоятельно.</p><p>Решите задачки, чтобы удостовериться, что вы всё правильно поняли.</p><h2 id="tasks"><a name="c" href="#c">Задачи (2)</a></h2><task-content><h3>  <a href="#вывести-alert-внешним-скриптом">Вывести alert внешним скриптом</a>  <task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Возьмите решение предыдущей задачи  <a data-load_page="8-1">Выведите alert</a> и вынесите скрипт во внешний файл  <code>alert.js</code>, который расположите в той же директории.</p><p>Откройте страницу и проверьте, что вывод сообщения всё ещё работает.</p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Код для HTML-файла:</p><code-example hover-style=""><script>`<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset="utf-8">\n</head>\n\n<body>\n\n  <script src="alert.js"><\/script>\n\n</body>\n\n</html>`</script></code-example><p>Для файла  <code>alert.js</code> из той же директории:</p><code-example><script>`alert(\'Я - JavaScript!\');`</script></code-example></task-answer></task-content><task-content><h3>  <a href="#какой-скрипт-выполнится-первым">Какой скрипт выполнится первым?</a>  <task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 4</span><p>В примере ниже подключены два скрипта  <code>small.js</code> и  <code>big.js</code>.</p><p>Если предположить, что  <code>small.js</code> загружается гораздо быстрее, чем  <code>big.js</code> – какой выполнится первым?</p><code-example><script>`<script src="big.js"><\/script>\n<script src="small.js"><\/script>`</script></code-example><p>А вот так?</p><code-example><script>`<script src="big.js" async><\/script>\n<script src="small.js" async><\/script>`</script></code-example><p>А так?</p><code-example><script>`<script src="big.js" defer><\/script>\n<script src="small.js" defer><\/script>`</script></code-example><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Ответы:</p><ol><li>Первым выполнится  <code>big.js</code>, это нормальная последовательность выполнения подряд идущих скриптов.</li><li>Первым выполнится  <code>small.js</code>, так как скрипты из-за  <code>async</code> ведут себя совершенно независимо друг от друга, страница тоже от них не зависит.</li><li>Первым выполнится  <code>big.js</code>, так как скрипты, подключённые через  <code>defer</code>, сохраняют порядок выполнения относительно друг друга.</li></ol></task-answer></task-content><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>!function () { /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || screen.width < 1024 || "bannerBottomDisabled" in localStorage || (localStorage.bannerBottomShownCount || (localStorage.bannerBottomShownCount = 1), document.querySelector(".banner-bottom").style.display = "block") }();</script><nav-book data-tooltips="Привет, мир!; Структура кода"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url = "https:\/\/learn.javascript.ru\/external-script", disqus_identifier = "external-script", disqus_title = "\u0412\u043d\u0435\u0448\u043d\u0438\u0435 \u0441\u043a\u0440\u0438\u043f\u0442\u044b, \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0438\u0441\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f";</script></page-content></main>