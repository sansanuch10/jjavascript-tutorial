function getCoords(e){var t=e.getBoundingClientRect(),r=document.body,o=document.documentElement,n=window.pageYOffset||o.scrollTop||r.scrollTop,a=window.pageXOffset||o.scrollLeft||r.scrollLeft,i=o.clientTop||r.clientTop||0,g=o.clientLeft||r.clientLeft||0,p=t.top+n-i,l=t.left+a-g;return{top:Math.round(p),left:Math.round(l)}}function getElementUnderClientXY(e,t,r){var o=e.style.display||"";e.style.display="none";var n=document.elementFromPoint(t,r);return e.style.display=o,n&&n!=document||(n=document.body),n}function extend(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.parent=t.prototype}var dragManager=new function(){var e,t,r,o,n;function a(){e=t=r=null}document.ondragstart=function(){return!1},document.onmousemove=function(i){if(e){if(!t){if(Math.abs(i.pageX-o)<3&&Math.abs(i.pageY-n)<3)return;if(!(t=e.onDragStart(o,n,i)))return void a()}t.onDragMove(i);var g=function(e){for(var r=t.getTargetElem();r!=document&&!r.dropTarget;)r=r.parentNode;return r.dropTarget?r.dropTarget:null}();return g!=r&&(r&&r.onDragLeave(g,t,i),g&&g.onDragEnter(r,t,i)),(r=g)&&r.onDragMove(t,i),!1}},document.onmouseup=function(e){if(1!=e.which)return!1;t&&(r?r.onDragEnd(t,e):t.onDragCancel()),a()},document.onmousedown=function(t){return 1==t.which&&((e=function(e){for(var t=e.target;t!=document&&!t.dragZone;)t=t.parentNode;return t.dragZone}(t))?(o=t.pageX,n=t.pageY,!1):void 0)}};function DragAvatar(e,t){this._dragZone=e,this._dragZoneElem=t,this._elem=t}function DragZone(e){e.dragZone=this,this._elem=e}function DropTarget(e){e.dropTarget=this,this._elem=e,this._targetElem=null}function TreeDragAvatar(e,t){DragAvatar.apply(this,arguments)}function TreeDragZone(e){DragZone.apply(this,arguments)}function TreeDropTarget(e){TreeDropTarget.parent.constructor.apply(this,arguments)}DragAvatar.prototype.initFromEvent=function(e,t,r){},DragAvatar.prototype.getDragInfo=function(e){return{elem:this._elem,dragZoneElem:this._dragZoneElem,dragZone:this._dragZone}},DragAvatar.prototype.getTargetElem=function(){return this._currentTargetElem},DragAvatar.prototype.onDragMove=function(e){this._elem.style.left=e.pageX-this._shiftX+"px",this._elem.style.top=e.pageY-this._shiftY+"px",this._currentTargetElem=getElementUnderClientXY(this._elem,e.clientX,e.clientY)},DragAvatar.prototype.onDragCancel=function(){},DragAvatar.prototype.onDragEnd=function(){},DragZone.prototype._makeAvatar=function(){},DragZone.prototype.onDragStart=function(e,t,r){var o=this._makeAvatar();return!!o.initFromEvent(e,t,r)&&o},DropTarget.prototype._getTargetElem=function(e,t){return this._elem},DropTarget.prototype._hideHoverIndication=function(e){},DropTarget.prototype._showHoverIndication=function(e){},DropTarget.prototype.onDragMove=function(e,t){var r=this._getTargetElem(e,t);this._targetElem!=r&&(this._hideHoverIndication(e),this._targetElem=r,this._showHoverIndication(e))},DropTarget.prototype.onDragEnd=function(e,t){this._hideHoverIndication(e),this._targetElem=null},DropTarget.prototype.onDragEnter=function(e,t,r){},DropTarget.prototype.onDragLeave=function(e,t,r){this._hideHoverIndication(),this._targetElem=null},extend(TreeDragAvatar,DragAvatar),TreeDragAvatar.prototype.initFromEvent=function(e,t,r){if("SPAN"!=r.target.tagName)return!1;this._dragZoneElem=r.target;var o=this._elem=this._dragZoneElem.cloneNode(!0);o.className="avatar";var n=getCoords(this._dragZoneElem);return this._shiftX=e-n.left,this._shiftY=t-n.top,document.body.appendChild(o),o.style.zIndex=9999,o.style.position="absolute",!0},TreeDragAvatar.prototype._destroy=function(){this._elem.parentNode.removeChild(this._elem)},TreeDragAvatar.prototype.onDragCancel=function(){this._destroy()},TreeDragAvatar.prototype.onDragEnd=function(){this._destroy()},extend(TreeDragZone,DragZone),TreeDragZone.prototype._makeAvatar=function(){return new TreeDragAvatar(this,this._elem)},extend(TreeDropTarget,DropTarget),TreeDropTarget.prototype._showHoverIndication=function(){this._targetElem&&this._targetElem.classList.add("hover")},TreeDropTarget.prototype._hideHoverIndication=function(){this._targetElem&&this._targetElem.classList.remove("hover")},TreeDropTarget.prototype._getTargetElem=function(e,t){var r=e.getTargetElem();if("SPAN"==r.tagName){for(var o=e.getDragInfo(t).dragZoneElem.parentNode,n=r;n;){if(n==o)return;n=n.parentNode}return r}},TreeDropTarget.prototype.onDragEnd=function(e,t){if(this._targetElem){this._hideHoverIndication();var r=e.getDragInfo(t);e.onDragEnd();var o=r.dragZoneElem.parentNode,n=r.dragZoneElem.innerHTML,a=this._targetElem.parentNode.getElementsByTagName("UL")[0];a||(a=document.createElement("UL"),this._targetElem.parentNode.appendChild(a));for(var i=null,g=0;g<a.children.length;g++){if((i=a.children[g]).children[0].innerHTML>n)break;i=null}a.insertBefore(o,i),this._targetElem=null}else e.onDragCancel()};