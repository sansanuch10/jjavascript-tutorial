<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="1">Язык JavaScript</a><arrow-next></arrow-next><a data-load_page="74">ООП в прототипном стиле</a></nav-up><h1>Свои классы на прототипах</h1><p>Используем ту же структуру, что JavaScript использует внутри себя, для объявления своих классов.</p><h2><a name="0" href="#0">Обычный конструктор</a></h2><p>Вспомним, как мы объявляли классы ранее.</p><p>Например, этот код задаёт класс <code>Animal</code> в функциональном стиле, без всяких прототипов:</p><code-example><script>`function Animal(name) {\n  this.speed = 0;\n  this.name = name;\n\n  this.run = function(speed) {\n    this.speed += speed;\n    alert( this.name + ' бежит, скорость&nbsp' + this.speed );\n  };\n\n  this.stop = function() {\n    this.speed = 0;\n    alert( this.name + ' стоит' );\n  };\n};\n\nvar animal = new Animal('Зверь');\n\nalert( animal.speed ); // 0, начальная скорость\nanimal.run(3); // Зверь бежит, скорость 3\nanimal.run(10); // Зверь бежит, скорость 13\nanimal.stop(); // Зверь стоит`</script><code-toolbar></code-toolbar></code-example><h2><a name="1" href="#1">Класс через прототип</a></h2><p>А теперь создадим аналогичный класс, используя прототипы, наподобие того, как сделаны классы <code>Object</code>, <code>Date</code> и остальные.</p><p>Чтобы объявить свой класс, нужно:</p><ol><li>Объявить функцию-конструктор.</li><li>Записать методы и свойства, нужные всем объектам класса, в <code>prototype</code>.</li></ol><p>Опишем класс <code>Animal</code>:</p><code-example><script>`// конструктор\nfunction Animal(name) {\n  this.name = name;\n  this.speed = 0;\n}\n\n// методы в прототипе\nAnimal.prototype.run = function(speed) {\n  this.speed += speed;\n  alert( this.name + ' бежит, скорость&nbsp' + this.speed );\n};\n\nAnimal.prototype.stop = function() {\n  this.speed = 0;\n  alert( this.name + ' стоит' );\n};\n\nvar animal = new Animal('Зверь');\n\nalert( animal.speed ); // 0, свойство взято из прототипа\nanimal.run(5); // Зверь бежит, скорость 5\nanimal.run(5); // Зверь бежит, скорость 10\nanimal.stop(); // Зверь стоит`</script><code-toolbar></code-toolbar></code-example><p>В объекте <code>animal</code> будут храниться свойства конкретного экземпляра: <code>name</code> и <code>speed</code>, а общие методы – в прототипе.</p><p>Совершенно такой же подход, как и для встроенных классов в JavaScript.</p><h2><a name="2" href="#2">Сравнение</a></h2><p>Чем такое задание класса лучше и хуже функционального стиля?</p><balance-><balance-pluses><div>Достоинства</div><ul><li>Функциональный стиль записывает в каждый объект и свойства и методы, а прототипный – только свойства. Поэтому прототипный стиль – быстрее и экономнее по памяти.</li></ul></balance-pluses><balance-minuses><div>Недостатки</div><ul><li>При создании методов через прототип, мы теряем возможность использовать локальные переменные как приватные свойства, у них больше нет общей области видимости с конструктором.</li></ul></balance-minuses></balance-><p>Таким образом, прототипный стиль – быстрее и экономнее, но немного  менее удобен.</p><p>К примеру, есть у нас приватное свойство <code>name</code> и метод <code>sayHi</code> в функциональном стиле ООП:</p><code-example><script>`function Animal(name) {\n  this.sayHi = function() {\nMARK    alert( name );\n  };\n}\n\nvar animal = new Animal("Зверь");\nanimal.sayHi(); // Зверь`</script><code-toolbar></code-toolbar></code-example><p>При задании методов в прототипе мы не сможем её так оставить, ведь методы находятся <em>вне</em> конструктора, у них нет общей области видимости, поэтому приходится записывать <code>name</code> в сам объект, обозначив его как защищённое:</p><code-example><script>`function Animal(name) {\nMARK  this._name = name;\n}\n\nAnimal.prototype.sayHi = function() {\nMARK  alert( this._name );\n}\n\nvar animal = new Animal("Зверь");\nanimal.sayHi(); // Зверь`</script><code-toolbar></code-toolbar></code-example><p>Впрочем, недостаток этот – довольно условный. Ведь при наследовании в функциональном стиле также пришлось бы писать <code>this._name</code>, чтобы потомок получил доступ к этому значению.</p><h2 id="tasks"><a href="#3" name="3">Задачи (2)</a></h2><task-content><h3><a href="#6" name="6">Перепишите в виде класса</a><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Есть класс <code>CoffeeMachine</code>, заданный в функциональном стиле.</p><p>Задача: переписать <code>CoffeeMachine</code> в виде класса с использованием прототипа.</p><p>Исходный код:</p><code-example><script>`function CoffeeMachine(power) {\n  var waterAmount = 0;\n\n  var WATER_HEAT_CAPACITY = 4200;\n\n  function getTimeToBoil() {\n    return waterAmount * WATER_HEAT_CAPACITY * 80 / power;\n  }\n\n  this.run = function() {\n    setTimeout(function() {\n      alert( 'Кофе готов!' );\n    }, getTimeToBoil());\n  };\n\n  this.setWaterAmount = function(amount) {\n    waterAmount = amount;\n  };\n\n}\n\nvar coffeeMachine = new CoffeeMachine(10000);\ncoffeeMachine.setWaterAmount(50);\ncoffeeMachine.run();`</script><code-toolbar></code-toolbar></code-example><p>P.S. При описании через прототипы локальные переменные недоступны методам, поэтому нужно будет переделать их в защищённые свойства.</p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><code-example><script>`function CoffeeMachine(power) {\n  // свойства конкретной кофеварки\n  this._power = power;\n  this._waterAmount = 0;\n}\n\n// свойства и методы для всех объектов класса\nCoffeeMachine.prototype.WATER_HEAT_CAPACITY = 4200;\n\nCoffeeMachine.prototype._getTimeToBoil = function() {\n  return this._waterAmount * this.WATER_HEAT_CAPACITY * 80 / this._power;\n};\n\nCoffeeMachine.prototype.run = function() {\n  setTimeout(function() {\n    alert( 'Кофе готов!' );\n  }, this._getTimeToBoil());\n};\n\nCoffeeMachine.prototype.setWaterAmount = function(amount) {\n  this._waterAmount = amount;\n};\n\nvar coffeeMachine = new CoffeeMachine(10000);\ncoffeeMachine.setWaterAmount(50);\ncoffeeMachine.run();`</script><code-toolbar></code-toolbar></code-example></task-answer></task-content><task-content><h3><a href="#7" name="7">Хомяки с __proto__</a><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Вы – руководитель команды, которая разрабатывает игру, хомяковую ферму. Один из программистов получил задание создать класс «хомяк» (англ – <code>"Hamster"</code>).</p><p>Объекты-хомяки должны иметь массив <code>food</code> для хранения еды и метод <code>found</code> для добавления.</p><p>Ниже – его решение. При создании двух хомяков, если поел один – почему-то сытым становится и второй тоже.</p><p>В чём дело? Как поправить?</p><code-example><script>`function Hamster() {}\n\nHamster.prototype.food = []; // пустой "живот"\n\nHamster.prototype.found = function(something) {\n  this.food.push(something);\n};\n\n// Создаём двух хомяков и кормим первого\nvar speedy = new Hamster();\nvar lazy = new Hamster();\n\nspeedy.found("яблоко");\nspeedy.found("орех");\n\nalert( speedy.food.length ); // 2\nalert( lazy.food.length ); // 2 (!??)`</script><code-toolbar></code-toolbar></code-example><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer-ext><button-answer-ext data-toggle_answer_ext="" style="">Почему возникает проблема</button-answer-ext><task-answer><close- title="закрыть" data-close_answer=""></close-><h4>Почему возникает проблема</h4><p>Давайте подробнее разберем происходящее при вызове <code>speedy.found("яблоко")</code>:</p><ol><li>Интерпретатор ищет свойство <code>found</code> в <code>speedy</code>. Но <code>speedy</code> – пустой объект, т.к. <code>new Hamster</code> ничего не делает с <code>this</code>.</li><li>Интерпретатор идёт по ссылке <code>speedy.__proto__ (==Hamster.prototype)</code> и находят там метод <code>found</code>, запускает его.</li><li>Значение <code>this</code> устанавливается в объект перед точкой, т.е. в <code>speedy</code>.</li><li>Для выполнения <code>this.food.push()</code> нужно найти свойство <code>this.food</code>. Оно отсутствует в <code>speedy</code>, но есть в <code>speedy.__proto__</code>.</li><li>Значение <code>"яблоко"</code> добавляется в <code>speedy.__proto__.food</code>.</li></ol><p><strong>У всех хомяков общий живот!</strong> Или, в терминах JavaScript, свойство <code>food</code> изменяется в прототипе, который является общим для всех объектов-хомяков.</p><p>Заметим, что этой проблемы не было бы при простом присваивании:</p><code-example><script>`this.food = something;`</script></code-example><p>В этом случае значение записалось бы в сам объект, без поиска <code>found</code> в прототипе.</p><p><strong>Проблема возникает только со свойствами-объектами в прототипе.</strong></p><p>Для исправления проблемы нужно дать каждому хомяку свой живот. Это можно сделать, присвоив его в конструкторе.</p><code-example><script>`function Hamster() {\nMARK  this.food = [];\n}\n\nHamster.prototype.found = function(something) {\n  this.food.push(something);\n};\n\nvar speedy = new Hamster();\nvar lazy = new Hamster();\n\nspeedy.found("яблоко");\nspeedy.found("орех");\n\nalert(speedy.food.length) // 2\nalert(lazy.food.length) // 0(!)`</script><code-toolbar></code-toolbar></code-example><p>Теперь всё в порядке. У каждого хомяка – свой живот.</p></task-answer></task-answer-ext></task-content><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>!function () { /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || screen.width < 1024 || "bannerBottomDisabled" in localStorage || (localStorage.bannerBottomShownCount || (localStorage.bannerBottomShownCount = 1), document.querySelector(".banner-bottom").style.display = "block") }();</script><nav-book data-tooltips="Встроенные 'классы' в JavaScript; Наследование классов в JavaScript"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url = "https:\/\/learn.javascript.ru\/classes", disqus_identifier = "classes", disqus_title = "\u0421\u0432\u043e\u0438 \u043a\u043b\u0430\u0441\u0441\u044b \u043d\u0430 \u043f\u0440\u043e\u0442\u043e\u0442\u0438\u043f\u0430\u0445";</script></page-content></main>