<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="190">Окна и Фреймы</a></nav-up><h1>Общение между окнами и фреймами</h1><p>Элемент <code>iframe</code> является обычным узлом DOM, как и любой другой. Существенное отличие – в том, что с ним связан объект <code>window</code> внутреннего окна. Он доступен по ссылке <code>iframe.contentWindow</code>.</p><p>Таким образом, <code>iframe.contentWindow.document</code> будет внутренним документом, <code>iframe.contentWindow.document.body</code> – его <code>&lt;body&gt;</code> и так далее.</p><important-><h3>Когда-то…</h3><p>В старых браузерах использовались другие свойства, такие как <code>iframe.contentDocument</code> и даже <code>iframe.document</code>, но они давно не нужны.</p></important-><h2><a name="0" href="#0">Переход внутрь ифрейма</a></h2><p>В примере ниже JavaScript получает документ внутри ифрейма и модифицирует его:</p><code-example><script>`<iframe src="javascript:'GREEN_тест'GREEN_" style="height:60px"></iframe>\n&nbsp\n<script>\n  var iframe = document.getElementsByTagName('iframe')[0];\n&nbsp\n  var iframeDoc = iframe.contentWindow.document;\n&nbsp\n  if (iframeDoc.readyState == 'complete') {\n    iframeDoc.body.style.backgroundColor = 'green';\n  }\n  iframe.onload = function() {\n    var iframeDoc2 = iframe.contentWindow.document;\n    iframeDoc2.body.style.backgroundColor = 'orange';\n  }\n<\/script>`</script><code-toolbar iframe="100"></code-toolbar></code-example><important-><h3>src=„javascript:«текст»“</h3><p>Атрибут <code>src</code> может использовать протокол <code>javascript</code>, как указано выше: <code>src="javascript:код"</code>. При этом код выполняется и его результат будет содержимым ифрейма. Этот способ описан в стандарте и поддерживается всеми браузерами.</p><p>Атрибут <code>src</code> является обязательным, и его отсутствие может привести к проблемам, вплоть до игнорирования ифрейма браузером. Чтобы ничего не загружать в ифрейм, можно указать пустую строку: <code>src="javascript:''"</code> или специальную страницу: <code>src="about:blank"</code>.</p></important-><p>В некоторых браузерах (Chrome) пример выше покажет <code>iframe</code> зелёным. А в некоторых (Firefox) – оранжевым.</p><p>Дело в том, что, когда <code>iframe</code> только создан, документ в нём обычно ещё не загружен.</p><p>При обычных значениях <code>iframe src="..."</code>, которые указывают на HTML-страницу (даже если она уже в кеше), это всегда так. Документ, который в <code>iframe</code> на момент срабатывания скрипта <code>iframeDoc</code> – временный, он будет заменён на новый очень скоро. И работать надо уже с новым документом <code>iframeDoc2</code> – например, по событию <code>iframe.onload</code>.</p><p>В случае с <code>javascript</code>-протоколом, по идее, ифрейм уже загружен, и тогда <code>onload</code> у него уже не будет. Но здесь мнения браузеров расходятся, некоторые (Firefox) всё равно «подгрузят» документ позже. Поэтому факт «готовности» документа в скрипте проверяется через <code>iframeDoc.readyState</code>.</p><p>Ещё раз заметим, что при обычных URL в качестве <code>src</code> нужно работать не с начальным документом, а с тем, который появится позже.</p><h2><a name="1" href="#1">Кросс-доменность: ограничение доступа к окну</a></h2><p>Элемент <code>&lt;iframe&gt;</code> является «двуличным». С одной стороны, это обычный узел DOM, с другой – внутри находится окно, которое может иметь совершенно другой URL, содержать независимый документ из другого источника.</p><p>Внешний документ имеет полный доступ к <code>&lt;iframe&gt;</code> как к DOM-узлу. А вот к окну – если они с одного источника.</p><p>Это приводит к забавным последствиям. Например, чтобы узнать об окончании загрузки <code>&lt;iframe&gt;</code>, мы можем повесить обработчик <code>iframe.onload</code>. По сути, это то же самое что <code>iframe.contentWindow.onload</code>, но его мы можем поставить лишь в случае, если окно с того же источника.</p><code-example><script>`<iframe src="https://example.com" style="height:100px"></iframe>\n\n<script>\n  var iframe = document.getElementsByTagName('iframe')[0];\n\n  // сработает\n  iframe.onload = function() {\n    alert( "iframe onload" );\n  };\n\n  // не сработает\n  iframe.contentWindow.onload = function() {\n    alert( "contentWindow onload" );\n  };\n<\/script>`</script><code-toolbar iframe="200"><a title="показать" data-code_run="0"></a><a title="открыть в песочнице" data-code_edit=""></a></code-toolbar></code-example><p>Если бы в примере выше <code>&lt;iframe src&gt;</code> был с текущего сайта, то оба обработчика сработали бы.</p><h2><a name="2" href="#2">Иерархия window.frames</a></h2><p>Альтернативный способ доступа к окну ифрейма – это получить его из коллекции <code>window.frames</code>.</p><p>Есть два способа доступа:</p><ol><li><code>window.frames[0]</code> – доступ по номеру.</li><li><code>window.frames.iframeName</code> – доступ по <code>name</code> ифрейма.</li></ol><p>Обратим внимание: в коллекции хранится именно окно (<code>contentWindow</code>), а не DOM-элемент.</p><p>Демонстрация всех способов доступа к окну:</p><code-example><script>`<iframe src="javascript:'GREEN_'GREEN_" style="height:80px" name="i"></iframe>\n\n<script>\n  var iframeTag = document.body.children[0];\n\n  var iframeWindow = iframeTag.contentWindow; // окно из тега\n\n  alert( frames[0] === iframeWindow ); // true, окно из коллекции frames\n  alert( frames.i == iframeWindow ); // true, окно из frames по имени\n<\/script>`</script><code-toolbar iframe="110"><a title="показать" data-code_run="105"></a><a title="открыть в песочнице" data-code_edit=""></a></code-toolbar></code-example><p>Внутри ифрейма могут быть свои вложенные ифреймы. Всё это вместе образует иерархию.</p><p>Ссылки для навигации по ней:</p><ul><li><p><code>window.frames</code> – коллекция «детей» (вложенных ифреймов)</p></li><li><p><code>window.parent</code> – содержит ссылку на родительское окно, позволяет обратиться к нему из ифрейма.</p><p>Всегда верно:</p><code-example><script>`// (из окна со фреймом)\nwindow.frames[0].parent === window; // true`</script></code-example></li><li><p><code>window.top</code> – содержит ссылку на самое верхнее окно (вершину иерархии).</p><p>Всегда верно (в предположении, что вложенные фреймы существуют):</p><code-example><script>`window.frames[0].frames[0].frames[0].top === window`</script></code-example></li></ul><p><strong>Свойство <code>top</code> позволяет легко проверить, во фрейме ли находится текущий документ:</strong></p><code-example><script>`if (window == top) {\n  alert( 'Этот скрипт является окном верхнего уровня в браузере' );\n} else {\n  alert( 'Этот скрипт исполняется во фрейме!' );\n}`</script><code-toolbar iframe=""></code-toolbar></code-example><h2><a name="3" href="#3">Песочница sandbox</a></h2><p>Атрибут <code>sandbox</code> позволяет построить «песочницу» вокруг ифрейма, запретив ему выполнять ряд действий.</p><p>Наличие атрибута <code>sandbox</code>:</p><ul><li>Заставляет браузер считать ифрейм загруженным с другого источника, так что он и внешнее окно больше не могут обращаться к переменным друг друга.</li><li>Отключает формы и скрипты в ифрейме.</li><li>Запрещает менять <code>parent.location</code> из ифрейма.</li></ul><p>Пример ниже загружает в <code>&lt;iframe sandbox&gt;</code> документ с JavaScript и формой. Ни то ни другое не сработает:</p><code-tabs data-code_switch=""><tools-><button-0 class="current">index.html</button-0><button-1>sandboxed.html</button-1></tools-><code-example style="display: block;"><script src="index_sandbox.html">`<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset="UTF-8">\n</head>\n\n<body>\n\n  <iframe sandbox src="sandboxed.html"></iframe>\n\n</body>\n\n</html>`</script><code-toolbar iframe="250"><a title="показать" data-code_run="0"></a><a title="открыть в песочнице" data-code_edit=""></a></code-toolbar></code-example><code-example style=""><script>`<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset="UTF-8">\n</head>\n\n<body>\n\n  <script>\n    alert(1);\n  <\/script>\n\n  <form action="http://google.ru">\n    <input type="text">\n    <input type="submit" value="Отправить форму на http://google.ru">\n  </form>\n\n</body>\n\n</html>`</script></code-example></code-tabs><p>Если у атрибута <code>sandbox</code> нет значения, то браузер применяет максимум ограничений.</p><p>Атрибут <code>sandbox</code> может содержать через пробел список ограничений, которые не нужны:</p><dl><dt>allow-same-origin</dt><dd>Браузер будет считать документ в ифрейме пришедшим с другого домена и накладывать соответствующие ограничения на работу с ним. Если ифрейм и так с другого домена, то ничего не меняется.</dd><dt>allow-top-navigation</dt><dd>Разрешает ифрейму менять <code>parent.location</code>.</dd><dt>allow-forms</dt><dd>Разрешает отправлять формы из <code>iframe</code>.</dd><dt>allow-scripts</dt><dd>Разрешает выполнение скриптов из ифрейма. Но скриптам, всё же, будет запрещено открывать попапы.</dd></dl><important-><h3>На заметку:</h3><p>Цель атрибута <code>sandbox</code> – наложить дополнительные ограничения. Он не может снять уже существующие, в частности, убрать ограничения безопасности, если ифрейм с другого источника.</p></important-><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>! function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||screen.width<1024||"bannerBottomDisabled" in localStorage||(localStorage.bannerBottomShownCount||(localStorage.bannerBottomShownCount=1),document.querySelector(".banner-bottom").style.display="block")}();</script><nav-book data-tooltips="Открытие окон и методы window; Кросс-доменные ограничения и их обход"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url="https:\/\/learn.javascript.ru\/iframes",disqus_identifier="iframes",disqus_title="\u041e\u0431\u0449\u0435\u043d\u0438\u0435 \u043c\u0435\u0436\u0434\u0443 \u043e\u043a\u043d\u0430\u043c\u0438 \u0438 \u0444\u0440\u0435\u0439\u043c\u0430\u043c\u0438";</script></page-content></main>