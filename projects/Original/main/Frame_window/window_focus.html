<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="190">Окна и Фреймы</a></nav-up><h1>Привлечение внимания к окну</h1><p>Проверить, находится ли окно в фокусе, а также перевести внимание посетителя на него – сложно.</p><p>В первую очередь, это потому, что JavaScript не интегрирован с оконным менеджером ОС. Кроме того, браузер охраняет права посетителя: если он хочет скрыть окно, то JavaScript не может его остановить.</p><p>Но кое-что сделать, конечно, можно. Об этом и поговорим.</p><h2><a name="0" href="#0">Метод window.focus</a></h2><p>Метод <code>window.focus</code> позволяет сфокусироваться на окне. Он работает по-разному в разных ОС и браузерах.</p><p>Проверьте, например:</p><code-example><script>`setInterval(function() { window.focus() }, 1000);`</script><code-toolbar></code-toolbar></code-example><p>Что будет, если запустить этот код, и затем переключиться в другое окно или вкладку?</p><p>Можно подумать, что окно будет оказываться в фокусе раз в секунду. Но это не так.</p><p>Произойдет одно из трех:</p><ol><li>Вообще никакого эффекта. Самый распространённый случай, если в окне много вкладок.</li><li>Окно развернется (при необходимости) и выйдет на передний план. Обычно это происходит, когда метод <code>window.focus()</code> вызывается для попапа, а активно сейчас – главное окно. То есть, в этом случае вызов сработает.</li><li>Заголовок окна начнет мигать. Чтобы увидеть это в действии – откройте данную страницу в IE, запустите код и переключитесь на другое окно. Браузер попытается привлечь Ваше внимание миганием/мерцанием заголовка окна.</li></ol><h2><a name="1" href="#1">Мерцание заголовка</a></h2><p>В дополнение к <code>window.focus()</code> используют мерцание заголовка окна, как показано в примере ниже:</p><code-example><script>`<script>\n  var win = open('/', 'test', 'width=300,height=300')\n\n  function getAttention(win) {\n    if (win.closed) {\n      alert( "Окно закрыто, привлечь внимание к нему нельзя" );\n      return;\n    }\n\n    win.focus();\n    var i = 0;\n    var show = ['************', win.document.title];\n\n    var focusTimer = setInterval(function() {\n      if (win.closed) {\n        clearInterval(focusTimer);\n        return;\n      }\n      win.document.title = show[i++ % 2];\n    }, 1000);\n\n    win.document.onmousemove = function() {\n      clearInterval(focusTimer);\n      win.document.title = show[1];\n      win.document.onmousemove = null;\n    }\n  }\n<\/script>\n\n<input type="button" onclick="getAttention(win)" value="getAttention(win)">`</script><code-toolbar iframe="150"><a title="показать" data-code_run="0"></a><a title="открыть в песочнице" data-code_edit=""></a></code-toolbar></code-example><p>Запустите код и сверните всплывающее окно. А затем – нажмите кнопку с надписью «getAttention(win)». Браузер будет привлекать ваше внимание, как умеет ;)</p><p>Обратите внимание: в коде есть проверка на <code>win.closed</code>. Попытка манипулирования закрытым окном вызовет исключение.</p><p>Как только посетитель сфокусировался на окне индикация прекращается. Для определения момента фокусировки в примере выше используется событие <code>document.onmousemove</code>.</p><p>Можно было использовать событие <code>window.onfocus</code>, но, оказывается, оно ненадежно.</p><h2><a name="2" href="#2">Событие window.onfocus</a></h2><p>Вот переписанный вариант функции <code>getAttention(win)</code>, с использованием события <code>onfocus</code>:</p><code-example><script>`<script>\n  var win = open('/', 'test', 'width=300,height=300')\n\n  function getAttention(win) {\n    if (win.closed) {\n      alert( "Окно закрыто, привлечь внимание к нему нельзя" );\n      return;\n    }\n\n    var i = 0;\n    var show = ['************', win.document.title];\n\n    function stop() {\n      clearInterval(focusTimer);\n      win.document.title = show[1];\n    }\n\n    win.onfocus = function() {\n      stop();\n      win.onfocus = null;\n    }\n\n    var focusTimer = setInterval(function() {\n      if (win.closed) {\n        clearInterval(focusTimer);\n        return;\n      }\n\n      win.document.title = show[i++ % 2];\n    }, 1000);\n\n    win.focus();\n  }\n<\/script>\n\n<input type="button" onclick="getAttention(win)" value="getAttention(win)">`</script><code-toolbar iframe="150"><a title="показать" data-code_run="0"></a><a title="открыть в песочнице" data-code_edit=""></a></code-toolbar></code-example><p>Далее мы посмотрим случаи, когда он не срабатывает, и почему нам всё же нужно <code>document.onmousemove</code>.</p><h3><a name="6" href="#6">Когда событие onfocus не работает?</a></h3><p>Возможно такое, что посетитель переключается на окно, а <code>window.onfocus</code> не происходит.</p><p>Это потому, что переключение между окнами и фокусировка – это разные вещи. Например, если курсор находится в поле для ввода URL браузера, то считается, что окно не в фокусе, хотя посетитель переключился на это окно.</p><p>Попробуйте проделать следующее:</p><ol><li>Запустите пример с <code>getAttention</code> в Chrome или IE (кстати, в них нельзя отключить адресную панель).</li><li>Поместите курсор в панель адреса всплывающего окна.</li><li>Перейдите обратно к главному окну и нажмите кнопку <code>getAttention(win)</code></li></ol><p><strong>Вы увидите, что несмотря на то, что вы переключились на окно, и оно сейчас на переднем плане, событие <code>onfocus</code> не срабатывает.</strong></p><p>Есть и другие случаи, когда переключение между окнами не вызывает <code>window.onfocus</code>. Скажем, если окно сфокусировать щелчком в поле ввода формы, то в IE события <code>window.onfocus</code> (а также <code>window.onfocusin</code>) – не сработают!</p><p>Можно попробовать поймать момент фокусировки и по-другому, повесив дополнительные обработчики событий на <code>document</code>. В главе <a data-load_page="142">Фокусировка: focus/blur</a> описана техника делегирования для <code>focus/blur</code>.</p><p>Но этот способ получает фокус только если посетитель сфокусируется где-то в документе: щелкнет или сделает еще какое-то действие в документе, а не просто посмотрит на него и проведет над ним мышкой.</p><p>Впрочем, никто не мешает использовать сочетание всех описанных методов.</p><h2><a name="3" href="#3">Итого</a></h2><p>Фокусировка и привлечение внимания к окну:</p><ul><li><p>Метод <code>focus</code> для <code>window</code> не надёжен. Окнами и вкладками браузера можно уверенно управлять только на уровне ОС.</p><p>Поэтому для привлечения внимания посетителя к окну стоит также использовать мерцающий заголовок окна.</p></li></ul><p>Обнаружение переключения на окно:</p><ul><li><p>У <code>window</code> есть событие <code>onfocus</code>, но оно также ненадёжно.</p><p>Поэтому для определения переключения на окно – используйте его вместе с делегируемым <code>focus</code> на документе, а также <code>document.onmousemove</code>.</p></li></ul><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>! function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||screen.width<1024||"bannerBottomDisabled" in localStorage||(localStorage.bannerBottomShownCount||(localStorage.bannerBottomShownCount=1),document.querySelector(".banner-bottom").style.display="block")}();</script><nav-book data-tooltips="Общение окон с разных доменов: postMessage; Атака Clickjacking и защита от неё"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url="https:\/\/learn.javascript.ru\/window-focus",disqus_identifier="window-focus",disqus_title="\u041f\u0440\u0438\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u044f \u043a \u043e\u043a\u043d\u0443";</script></page-content></main>