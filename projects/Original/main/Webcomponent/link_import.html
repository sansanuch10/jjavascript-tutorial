<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="152">Веб-компоненты: взгляд в будущее</a></nav-up><h1>Импорты</h1><p>Новая спецификация <a href="http://w3c.github.io/webcomponents/spec/imports/index.html">«HTML Imports»</a> описывает, как вставить один документ в другой при помощи HTML-тега <code>&lt;link rel="import"&gt;</code>.</p><h2><a name="0" href="#0">Зачем?</a></h2><p>Мы ведь и так можем вставлять документ в документ, при помощи <code>&lt;iframe&gt;</code>, зачем нужен ещё какой-то импорт? Что не так с <code>iframe</code>?</p><p>…С <code>iframe</code> всё так. Однако, по своему смыслу <code>iframe</code> – это отдельный документ.</p><ul><li>Для <code>iframe</code> создаётся полностью своё окружение, у него свой объект <code>window</code> и свои переменные.</li><li>Если <code>iframe</code> загружен с другого домена, то взаимодействие с ним возможно только через <code>postMessage</code>.</li></ul><p>Это хорошо, когда нужно действительно в одной странице отобразить содержимое другой.</p><p>А что, если нужно встроить другой документ как естественную часть текущего? С единым скриптовым пространством, едиными стилями, но при этом – другой документ.</p><p>Например, это нужно для подгрузки внешних частей документа (веб-компонент) снаружи. И желательно не иметь проблем с разными доменами: если уж мы действительно хотим подключить HTML с одного домена в страницу на другом – мы должны иметь возможность это сделать без «плясок с бубном».</p><p>Иначе говоря, <code>&lt;link rel="import"&gt;</code> – это аналог <code>&lt;script&gt;</code>, но для подключения полноценных документов, с шаблонами, библиотеками, веб-компонентами и т.п. Всё станет понятнее, когда мы посмотрим детали.</p><h2><a name="1" href="#1">Пример вставки</a></h2><p>Синтаксис:</p><code-example><script>`<link rel="import" href="http://site.com/document.html">`</script></code-example><ul><li>В отличие от <code>&lt;iframe&gt;</code> тег <code>&lt;link rel="import"&gt;</code> может быть в любом месте документа, даже в <code>&lt;head&gt;</code>.</li><li>При вставке через <code>&lt;iframe&gt;</code> документ показывается внутри фрейма. В случае с <code>&lt;link rel="import"&gt;</code> это не так, по умолчанию документ вообще не показывается.</li></ul><p><strong>HTML, загруженный через <code>&lt;link rel="import"&gt;</code> имеет отдельный DOM документа, но скрипты в нём выполняются в общем контексте страницы.</strong></p><p>Файл, загруженный через <code>&lt;link rel="import"&gt;</code>, обрабатывается, выполняются скрипты, строится DOM документа, но не показывается, а записывается в свойство <code>link.import</code>.</p><p>Мы сами решаем, где и когда его вставить.</p><p>В примере ниже <code>&lt;link rel="import" href="timer.html"&gt;</code> подключает документ <code>timer.html</code> и, после его загрузки, вызывает функцию <code>show</code>. Эта функция через <code>link.import.querySelector('time')</code> выбирает интересующую часть подгруженного документа и вставляет её в текущий:</p><code-example><script>`<!DOCTYPE HTML>\n<html>\n\n<body>\n\n  <script>\n    function show() {\n      var time = link.import.querySelector('time')\n      document.body.appendChild(time);\n    };\n  <\/script>\n\n  <link rel="import" id="link" onload="show()" href="timer.html">\n\n</body>\n\n</html>`</script></code-example><p>В файле <code>timer.html</code> находится элемент и скрипт, который его «оживляет»:</p><code-example><script>`<!DOCTYPE HTML>\n<html>\n\n<body>\n\n  <time id="timer">0</time>\n\n  <script>\n    var localDocument = document.currentScript.ownerDocument;\n    var timer = localDocument.getElementById('timer');\n\n    var timerId = setInterval(function() {\n      timer.innerHTML++;\n    }, 1000);\n  <\/script>\n\n</body>\n\n</html>`</script></code-example><code-tabs data-code_switch=""><tools-><button-0 class="current">index.html</button-0><button-1>timer.html</button-1></tools-><code-example style="display: block;"><script>`<!DOCTYPE HTML>\n<html>\n\n<body>\n\n  <script>\n    function show() {\n      var time = link.import.querySelector('time')\n      document.body.appendChild(time);\n    };\n  <\/script>\n\n  <link rel="import" id="link" onload="show()" href="timer.html">\n\n</body>\n\n</html>`</script><code-toolbar iframe="80"><a title="показать" data-code_run="220"></a><a title="открыть в песочнице" data-code_edit=""></a></code-toolbar></code-example><code-example><script>`<!DOCTYPE HTML>\n<html>\n\n<body>\n\n  <time id="timer">0</time>\n\n  <script>\n    var localDocument = document.currentScript.ownerDocument;\n    var timer = localDocument.getElementById('timer');\n\n    var timerId = setInterval(function() {\n      timer.innerHTML++;\n    }, 1000);\n  <\/script>\n\n</body>\n\n</html>`</script></code-example></code-tabs><p>Важные детали:</p><ul><li>После загрузки все скрипты в подключённом <code>timer.html</code> выполняются в контексте основной страницы, так что <code>timer</code> и другие переменные станут глобальными переменными страницы.</li><li>Переменная <code>document</code> – это документ основной страницы. Для доступа к импортированному, то есть текущему документу изнутри <code>timer.html</code> его можно получить как <code>document.currentScript.ownerDocument</code>.</li><li>Таймер в загруженном документе начинает работать сразу, новый документ оживает сразу после загрузки, хотя до переноса узлов в основной документ этого может быть и не видно.</li></ul><p>В примере выше содержимым импорта управлял основной документ, но <code>timer.html</code> мог бы и показать сам себя вызовом <code>document.body.appendChild(timer)</code> или вызвать функцию с внешнего документа, так как у них единая область видимости. Тогда не понадобился бы никакой <code>onload</code>.</p><p>Ещё пример вставки, на этот раз документ только подключает <code>&lt;link&gt;</code>, а таймер вставляет себя сам:</p><code-tabs data-code_switch=""><tools-><button-0 class="current">index.html</button-0><button-1>timer_1.html</button-1></tools-><code-example style="display: block;"><script>`<!DOCTYPE HTML>\n<html>\n\n<head>\n  <link rel="import" id="link" href="timer_1.html">\n</head>\n\n<body></body>\n\n</html>`</script><code-toolbar iframe="60"><a title="показать" data-code_run="130"></a><a title="открыть в песочнице" data-code_edit=""></a></code-toolbar></code-example><code-example style=""><script>`<!DOCTYPE HTML>\n<html>\n\n<head>\n  <style>\n    GOLD_#timer_GOLD {\n      color: red;\n    }\n  </style>\n</head>\n\n<body>\n\n  <p id="timer">0</p>\n\n  <script>\n    var localDocument = document.currentScript.ownerDocument;\n    var timer = localDocument.getElementById('timer');\n\n    var timerId = setInterval(function() {\n      timer.innerHTML++;\n    }, 1000);\n\n    document.body.appendChild(timer);\n  <\/script>\n\n</body>\n\n</html>`</script></code-example></code-tabs><p>Обратим внимание – стили импорта попадают в контекст страницы. В примере выше импорт добавил и стиль для <code>#timer</code> и сам элемент.</p><h2><a name="2" href="#2">Веб-компоненты</a></h2><p>Импорт задуман как часть платформы Web Components.</p><p>Предполагается, что главный документ может импортировать файлы-определения, в которых будут все необходимые HTML, JS и CSS для элементов, а затем использовать их.</p><p>Пример:</p><code-example><script>`<link rel="import" href="ui-tabs.html">\n<link rel="import" href="ui-dialog.html">\n\n<RED_ui-tabs_RED>...</RED_ui-tabs_RED>\n<RED_ui-dialog_RED>...</RED_ui-dialog_RED>`</script></code-example><p>В следующей главе мы разберём расширенный пример на эту тему.</p><h2><a name="3" href="#3">Повторное использование</a></h2><p>Повторный импорт с тем же URL использует уже существующий документ.</p><p>Если файл <code>libs.html</code> импортирован два раза, то CSS и скрипты из него подключатся и выполнятся ровно один раз.</p><p>Это можно использовать, чтобы не подгружать одинаковые зависимости много раз. И сама страница и её импорты, и их подимпорты, и так далее, могут подключать <code>libs.html</code> без опасения лишний раз перезагрузить и выполнить скрипты.</p><p>Например:</p><ul><li><p>Главный файл <code>index.html</code> подключает документы:</p><code-example><script>`<link rel="import" href="ui-tabs.html">\n<link rel="import" href="ui-dialog.html">\n...`</script></code-example></li><li><p><code>ui-tabs.html</code> подключает <code>libs.html</code>:</p><code-example><script>`<link rel="import" href="libs.html">\n...template и код для табов...`</script></code-example></li><li><p><code>ui-dialog.html</code> также использует <code>libs.html</code>:</p><code-example><script>`<link rel="import" href="libs.html">\n...template и код для диалогов...`</script></code-example></li></ul><p>Файл <code>libs.html</code> при этом будет подключен только один раз. Это позволяет не бояться лишнего дублирования библиотек, используемых при описании множества компонент.</p><h2><a name="4" href="#4">Итого</a></h2><p>Тег <code>&lt;link rel="import"&gt;</code> позволяет подключить любой документ к странице, причём:</p><ul><li>Скриптовое пространство и стили со страницей будут общие.</li><li>Документ DOM – отдельный, он доступен как <code>link.import</code> снаружи, а из внутреннего скрипта – через <code>document.currentScript.ownerDocument</code>. Можно без проблем переносить элементы из главного документа в импорт и наоборот.</li><li>Импорты могут содержать другие импорты.</li><li>Если какой-то URL импортируется повторно – подключается уже готовый документ, без повторного выполнения скриптов в нём. Это позволяет избежать дублирования при использовании одной библиотеки во множестве мест.</li></ul><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>! function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||screen.width<1024||"bannerBottomDisabled" in localStorage||(localStorage.bannerBottomShownCount||(localStorage.bannerBottomShownCount=1),document.querySelector(".banner-bottom").style.display="block")}();</script><nav-book data-tooltips="Стили и селекторы; Веб-компонент в сборе"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url="https:\/\/learn.javascript.ru\/link-import",disqus_identifier="link-import",disqus_title="\u0418\u043c\u043f\u043e\u0440\u0442\u044b";</script></page-content></main>