<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="1">Язык JavaScript</a><arrow-next></arrow-next><a data-load_page="34">Структуры данных</a></nav-up><h1>Дата и Время</h1><p>Для работы с датой и временем в JavaScript используются объекты <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Date/">Date</a>.</p><h2><a name="0" href="#0">Создание</a></h2><p>Для создания нового объекта типа <code>Date</code> используется один из синтаксисов:</p><dl><dt><code>new Date()</code></dt><dd><p>Создает объект  <code>Date</code> с текущей датой и временем:</p><code-example><script>`var now = new Date();\nalert( now );`</script><code-toolbar></code-toolbar></code-example></dd><dt><code>new Date(milliseconds)</code></dt><dd><p>Создает объект  <code>Date</code>, значение которого равно количеству миллисекунд (1/1000 секунды), прошедших с 1 января 1970 года GMT+0.</p><code-example><script>`// 24 часа после 01.01.1970 GMT+0\nvar Jan02_1970 = new Date(3600 * 24 * 1000);\nalert( Jan02_1970 );`</script><code-toolbar></code-toolbar></code-example></dd><dt><code>new Date(datestring)</code></dt><dd><p>Если единственный аргумент – строка, используется вызов  <code>Date.parse</code> (см. далее) для чтения даты из неё.</p></dd><dt><code>new Date(year, month, date, hours, minutes, seconds, ms)</code></dt><dd><p>Дату можно создать, используя компоненты в местной временной зоне. Для этого формата обязательны только первые  два аргумента. Отсутствующие параметры, начиная с  <code>hours</code> считаются равными нулю, а  <code>date</code> – единице.</p><p>Заметим:</p></dd></dl><ul><li>  <p>Год  <code>year</code> должен быть из 4 цифр.</p></li><li>  <p>Отсчет месяцев  <code>month</code> начинается с нуля 0.</p>  <p>Например:</p>  <code-example>  <script>`new Date(2011, 0, 1, 0, 0, 0, 0); // // 1 января 2011, 00:00:00\nnew Date(2011, 0, 1); // то же самое, часы/секунды по умолчанию равны 0`</script></code-example>  <p>Дата задана с точностью до миллисекунд:</p>  <code-example>  <script>`var date = new Date(2011, 0, 1, 2, 3, 4, 567);\nalert( date ); // 1.01.2011, 02:03:04.567`</script>  <code-toolbar></code-toolbar>  </code-example></li></ul><h2><a name="1" href="#1">Получение компонентов даты</a></h2><p>Для доступа к компонентам даты-времени объекта <code>Date</code> используются следующие методы:</p><dl><dt><code>getFullYear()</code></dt><dd>Получить год (из 4 цифр)</dd><dt><code>getMonth()</code></dt><dd>Получить месяц,  <strong>от 0 до 11</strong>.</dd><dt><code>getDate()</code></dt><dd>Получить число месяца, от 1 до 31.</dd><dt><code>getHours(), getMinutes(), getSeconds(), getMilliseconds()</code></dt><dd>Получить соответствующие компоненты.</dd></dl><important-warn><h3>Не  <code>getYear()</code>, а  <code>getFullYear()</code></h3><p>Некоторые браузеры реализуют нестандартный метод  <code>getYear()</code>. Где-то он возвращает только две цифры из года, где-то четыре. Так или иначе, этот метод отсутствует в стандарте  JavaScript. Не используйте его. Для получения года есть  <code>getFullYear()</code>.</p></important-warn><p>Дополнительно можно получить день недели:</p><dl><dt><code>getDay()</code></dt><dd>Получить номер дня в неделе. Неделя в JavaScript начинается с воскресенья, так что результат будет числом  <strong>от 0(воскресенье) до 6(суббота)</strong>.</dd></dl><p><strong>Все методы, указанные выше, возвращают результат для местной временной зоны.</strong></p><p>Существуют также UTC-варианты этих методов, возвращающие день, месяц, год и т.п. для зоны GMT+0 (UTC): <code>getUTCFullYear()</code>, <code>getUTCMonth()</code>, <code>getUTCDay()</code>. То есть, сразу после <code>"get"</code> вставляется <code>"UTC"</code>.</p><p>Если ваше локальное время сдвинуто относительно UTC, то следующий код покажет разные часы:</p><code-example><script>`// текущая дата\nvar date = new Date();\n\n// час в текущей временной зоне\nalert( date.getHours() );\n\n// сколько сейчас времени в Лондоне?\n// час в зоне GMT+0\nalert( date.getUTCHours() );`</script><code-toolbar></code-toolbar></code-example><p>Кроме описанных выше, существуют два специальных метода без UTC-варианта:</p><dl><dt><code>getTime()</code></dt><dd><p>Возвращает число миллисекунд, прошедших с 1 января 1970 года GMT+0, то есть того же вида, который используется  в конструкторе  <code>new Date(milliseconds)</code>.</p></dd><dt><code>getTimezoneOffset()</code></dt><dd><p>Возвращает разницу между местным и UTC-временем, в минутах.</p><code-example><script>`alert( new Date().getTimezoneOffset() ); // Д`</script><code-toolbar></code-toolbar></code-example></dd></dl><h2><a name="2" href="#2">Установка компонентов даты</a></h2><p>Следующие методы позволяют устанавливать компоненты даты и времени:</p><ul><li>  <code>setFullYear(year [, month, date])</code></li><li>  <code>setMonth(month [, date])</code></li><li>  <code>setDate(date)</code></li><li>  <code>setHours(hour [, min, sec, ms])</code></li><li>  <code>setMinutes(min [, sec, ms])</code></li><li>  <code>setSeconds(sec [, ms])</code></li><li>  <code>setMilliseconds(ms)</code></li><li>  <code>setTime(milliseconds)</code> (устанавливает всю дату по миллисекундам с 01.01.1970 UTC)</li></ul><p>Все они, кроме <code>setTime()</code>, обладают также UTC-вариантом, например: <code>setUTCHours()</code>.</p><p>Как видно, некоторые методы могут устанавливать несколько компонентов даты одновременно, в частности, <code>setHours</code>. При этом если какая-то компонента не указана, она не меняется. Например:</p><code-example><script>`var today = new Date;\n\ntoday.setHours(0);\nalert( today ); // сегодня, но час изменён на 0\n\ntoday.setHours(0, 0, 0, 0);\nalert( today ); // сегодня, ровно 00:00:00.`</script><code-toolbar></code-toolbar></code-example><h3><a name="10" href="#10">Автоисправление даты</a></h3><p><em>Автоисправление</em> – очень удобное свойство объектов <code>Date</code>. Оно заключается в том, что можно устанавливать заведомо некорректные компоненты (например 32 января), а объект сам себя поправит.</p><code-example><script>`var d = new Date(2013, 0, HIGH32LIGHT); // 32 января 2013 ?!?\nalert(d); // ... это 1 февраля 2013!`</script><code-toolbar></code-toolbar></code-example><p><strong>Неправильные компоненты даты автоматически распределяются по остальным.</strong></p><p>Например, нужно увеличить на 2 дня дату «28 февраля 2011». Может быть так, что это будет 2 марта, а может быть и 1 марта, если год високосный. Но нам обо всем этом думать не нужно. Просто прибавляем два дня. Остальное сделает <code>Date</code>:</p><code-example><script>`var d = new Date(2011, 1, 28);\nMARKd.setDate(d.getDate() + 2);\n\nalert( d ); // 2 марта, 2011`</script><code-toolbar></code-toolbar></code-example><p>Также это используют для получения даты, отдаленной от имеющейся на нужный промежуток времени. Например, получим дату на 70 секунд большую текущей:</p><code-example><script>`var d = new Date();\nd.setSeconds(d.getSeconds() + 70);\n\nalert( d ); // выведет корректную дату`</script><code-toolbar></code-toolbar></code-example><p>Можно установить и нулевые, и даже отрицательные компоненты. Например:</p><code-example><script>`var d = new Date;\n\nd.setDate(1); // поставить первое число месяца\nalert( d );\n\nd.setDate(0); // нулевого числа нет, будет последнее число предыдущего месяца\nalert( d );`</script><code-toolbar></code-toolbar></code-example><code-example><script>`var d = new Date;\n\nd.setDate(-1); // предпоследнее число предыдущего месяца\nalert( d );`</script><code-toolbar></code-toolbar></code-example><h3><a name="11" href="#11">Преобразование к числу, разность дат</a></h3><p>Когда объект <code>Date</code> используется в числовом контексте, он преобразуется в количество миллисекунд:</p><code-example><script>`alert(+new Date) // +date то же самое, что: +date.valueOf()`</script><code-toolbar></code-toolbar></code-example><p><strong>Важный побочный эффект: даты можно вычитать, результат вычитания объектов  <code>Date</code> – их временная разница, в миллисекундах</strong>.</p><p>Это используют для измерения времени:</p><code-example><script>`var start = new Date; // засекли время\n\n// что-то сделать\nfor (var i = 0; i < 100000; i++) {\n  var doSomething = i * i * i;\n}\n\nvar end = new Date; // конец измерения\n\nalert( "Цикл занял&nbsp" + (end - start) + " ms" );`</script><code-toolbar></code-toolbar></code-example><h3><a name="12" href="#12">Бенчмаркинг</a></h3><p>Допустим, у нас есть несколько вариантов решения задачи, каждый описан функцией.</p><p>Как узнать, какой быстрее?</p><p>Для примера возьмем две функции, которые бегают по массиву:</p><code-example><script>`function walkIn(arr) {\n  for (var key in arr) arr[key]++\n}\n\nfunction walkLength(arr) {\n  for (var i = 0; i < arr.length; i++) arr[i]++;\n}`</script></code-example><p>Чтобы померять, какая из них быстрее, нельзя запустить один раз <code>walkIn</code>, один раз <code>walkLength</code> и замерить разницу. Одноразовый запуск ненадежен, любая мини-помеха исказит результат.</p><p>Для правильного бенчмаркинга функция запускается много раз, чтобы сам тест занял существенное время. Это сведет влияние помех к минимуму. Сложную функцию можно запускать 100 раз, простую – 1000 раз…</p><p>Померяем, какая из функций быстрее:</p><code-example><script>`var arr = [];\nfor (var i = 0; i < 1000; i++) arr[i] = 0;\n\nfunction walkIn(arr) {\n  for (var key in arr) arr[key]++;\n}\n\nfunction walkLength(arr) {\n  for (var i = 0; i < arr.length; i++) arr[i]++;\n}\n\nfunction bench(f) {\n  var date = new Date();\n  for (var i = 0; i < 10000; i++) f(arr);\n  return new Date() - date;\n}\n\nalert( 'Время walkIn:&nbsp' + bench(walkIn) + 'мс' );\nalert( 'Время walkLength:&nbsp' + bench(walkLength) + 'мс' );`</script><code-toolbar></code-toolbar></code-example><p>Теперь представим себе, что во время первого бенчмаркинга <code>bench(walkIn)</code> компьютер что-то делал параллельно важное (вдруг) и это занимало ресурсы, а во время второго – перестал. Реальная ситуация? Конечно реальна, особенно на современных ОС, где много процессов одновременно.</p><p><strong>Гораздо более надёжные результаты можно получить, если весь пакет тестов прогнать много раз.</strong></p><code-example><script>`var arr = [];\nfor (var i = 0; i < 1000; i++) arr[i] = 0;\n\nfunction walkIn(arr) {\n  for (var key in arr) arr[key]++;\n}\n\nfunction walkLength(arr) {\n  for (var i = 0; i < arr.length; i++) arr[i]++;\n}\n\nfunction bench(f) {\n  var date = new Date();\n  for (var i = 0; i < 1000; i++) f(arr);\n  return new Date() - date;\n}\n\nMARK// bench для каждого теста запустим много раз, чередуя\nMARKvar timeIn = 0,\nMARK  timeLength = 0;\nMARKfor (var i = 0; i < 100; i++) {\nMARK  timeIn += bench(walkIn);\nMARK  timeLength += bench(walkLength);\nMARK}\n\nalert( 'Время walkIn:&nbsp' + timeIn + 'мс' );\nalert( 'Время walkLength:&nbsp' + timeLength + 'мс' );`</script><code-toolbar></code-toolbar></code-example><important-><h3>Более точное время с  <code>performance.now()</code></h3><p>В современных браузерах (кроме IE9-) вызов  <a href="https://developer.mozilla.org/en-US/docs/Web/API/performance.now">performance.now()</a> возвращает количество миллисекунд, прошедшее с начала загрузки страницы. Причём именно  с самого начала, до того, как загрузился HTML-файл, если точнее – с момента выгрузки предыдущей страницы  из памяти.</p><p>Так что это время включает в себя всё, включая начальное обращение к серверу.</p><p>Его можно посмотреть в любом месте страницы, даже в  <code>&lt;head&gt;</code>, чтобы узнать, сколько времени потребовалось браузеру, чтобы до него добраться, включая загрузку HTML.</p><p>Возвращаемое значение измеряется в миллисекундах, но дополнительно имеет точность 3 знака после запятой (до миллионных  долей секунды!), поэтому можно использовать его и для более точного бенчмаркинга в том числе.</p></important-><important-><h3>  <code>console.time(метка)</code> и  <code>console.timeEnd(метка)</code></h3><p>Для измерения с одновременным выводом результатов в консоли есть методы:</p><ul><li>  <code>console.time(метка)</code> – включить внутренний хронометр браузера с меткой.</li><li>  <code>console.timeEnd(метка)</code> – выключить внутренний хронометр браузера с меткой и вывести результат.</li></ul><p>Параметр  <code>"метка"</code> используется для идентификации таймера, чтобы можно было делать много замеров одновременно и даже вкладывать  измерения друг в друга.</p><p>В коде ниже таймеры  <code>walkIn</code>,  <code>walkLength</code> – конкретные тесты, а таймер «All Benchmarks» – время «на всё про всё»:</p><div hover-style=""><code-example><script>`var arr = [];\nfor (var i = 0; i < 1000; i++) arr[i] = 0;\n\nfunction walkIn(arr) {\n  for (var key in arr) arr[key]++;\n}\n\nfunction walkLength(arr) {\n  for (var i = 0; i < arr.length; i++) arr[i]++;\n}\n\nfunction bench(f) {\n  for (var i = 0; i < 10000; i++) f(arr);\n}\n\nconsole.time("All Benchmarks");\n\nconsole.time("walkIn");\nbench(walkIn);\nconsole.timeEnd("walkIn");\n\nconsole.time("walkLength");\nbench(walkLength);\nconsole.timeEnd("walkLength");\n\nconsole.timeEnd("All Benchmarks");`</script><code-toolbar></code-toolbar></code-example><p hover-style="font-size:13px" style="">При запуске этого примера <strong hover-style="color:orangered;font-size:16px" style="">нужно открыть консоль</strong>, иначе вы ничего не увидите.</p></div></important-><important-warn><h3>Внимание, оптимизатор!</h3><p>Современные интерпретаторы JavaScript делают массу оптимизаций, например:</p><ol><li>Автоматически выносят инвариант, то есть постоянное в цикле значение типа  <code>arr.length</code>, за пределы цикла.</li><li>Стараются понять, значения какого типа хранит данная переменная или массив, какую структуру имеет объект  и, исходя из этого, оптимизировать внутренние алгоритмы.</li><li>Выполняют простейшие операции, например сложение явно заданных чисел и строк, на этапе компиляции.</li><li>Могут обнаружить, что некий код, например присваивание к неиспользуемой локальной переменной, ни на что не  влияет и вообще исключить его из выполнения, хотя делают это редко.</li></ol><p>Эти оптимизации могут влиять на результаты тестов, поэтому измерять скорость базовых операций JavaScript («проводить  микробенчмаркинг») до того, как вы изучите внутренности JavaScript-интерпретаторов и поймёте, что они реально  делают на таком коде, не рекомендуется.</p></important-warn><h2><a name="3" href="#3">Форматирование и вывод дат</a></h2><p>Во всех браузерах, кроме IE10-, поддерживается новый стандарт <a href="http://www.ecma-international.org/publications/standards/Ecma-402.htm">Ecma 402</a>, который добавляет специальные методы для форматирования дат.</p><p>Это делается вызовом <code>date.toLocaleString(локаль, опции)</code>, в котором можно задать много настроек. Он позволяет указать, какие параметры даты нужно вывести, и ряд настроек вывода, после чего интерпретатор сам сформирует строку.</p><p>Пример с почти всеми параметрами даты и русским, затем английским (США) форматированием:</p><code-example><script>`var date = new Date(2014, 11, 31, 12, 30, 0);\n\nvar options = {\n  era: 'long',\n  year: 'numeric',\n  month: 'long',\n  day: 'numeric',\n  weekday: 'long',\n  timezone: 'UTC',\n  hour: 'numeric',\n  minute: 'numeric',\n  second: 'numeric'\n};\n\nalert( date.toLocaleString(\"ru\", options) ); // среда, 31 декабря 2014 г. н.э. 12:30:00\nalert( date.toLocaleString(\"en-US\", options) ); // Wednesday, December 31, 2014 Anno Domini 12:30:00 PM`</script><code-toolbar></code-toolbar></code-example><p>Вы сможете подробно узнать о них в статье <a data-load_page="242">Intl: интернационализация в JavaScript</a>, которая посвящена этому стандарту.</p><p><strong>Методы вывода без локализации:</strong></p><p><code>toString()</code>, <code>toDateString()</code>, <code>toTimeString()</code>Возвращают стандартное строчное представление, не заданное жёстко в стандарте, а зависящее от браузера. Единственное требование к нему – читаемость человеком. Метод <code>toString</code> возвращает дату целиком, <code>toDateString()</code> и <code>toTimeString()</code> – только дату и время соответственно.</p><code-example><script>`var d = new Date();\n\nalert( d.toString() ); // вывод, похожий на 'Wed Jan 26 2011 16:40:50 GMT+0300'`</script><code-toolbar></code-toolbar></code-example><p><code>toUTCString()</code>То же самое, что <code>toString()</code>, но дата в зоне UTC.</p><p><code>toISOString()</code>Возвращает дату в формате ISO Детали формата будут далее. Поддерживается современными браузерами, не поддерживается IE8-.</p><code-example><script>`var d = new Date();\n\nalert( d.toISOString() ); // вывод, похожий на '2011-01-26T13:51:50.417Z'`</script><code-toolbar></code-toolbar></code-example><p>Если хочется иметь большую гибкость и кросс-браузерность, то также можно воспользоваться специальной библиотекой, например <a href="http://momentjs.com/">Moment.JS</a> или написать свою функцию форматирования.</p><h2><a name="4" href="#4">Разбор строки, Date.parse</a></h2><p>Все современные браузеры, включая IE9+, понимают даты в упрощённом формате ISO 8601 Extended.</p><p>Этот формат выглядит так: <code>YYYY-MM-DDTHH:mm:ss.sssZ</code>, где:</p><ul><li>  <code>YYYY-MM-DD</code> – дата в формате год-месяц-день.</li><li>Обычный символ  <code>T</code> используется как разделитель.</li><li>  <code>HH:mm:ss.sss</code> – время: часы-минуты-секунды-миллисекунды.</li><li>Часть  <code>'Z'</code> обозначает временную зону – в формате  <code>+-hh:mm</code>, либо символ  <code>Z</code>, обозначающий UTC. По стандарту её можно не указывать, тогда UTC, но в Safari с этим ошибка, так что лучше  указывать всегда.</li></ul><p>Также возможны укороченные варианты, например <code>YYYY-MM-DD</code> или <code>YYYY-MM</code> или даже только <code>YYYY</code>.</p><p>Метод <code>Date.parse(str)</code> разбирает строку <code>str</code> в таком формате и возвращает соответствующее ей количество миллисекунд. Если это невозможно, <code>Date.parse</code> возвращает <code>NaN</code>.</p><p>Например:</p><code-example><script>`var msUTC = Date.parse('2012-01-26T13:51:50.417Z'); // зона UTC\n\nalert( msUTC ); // 1327571510417 (число миллисекунд)`</script><code-toolbar></code-toolbar></code-example><p>С таймзоной <code>-07:00 GMT</code>:</p><code-example><script>`var ms = Date.parse('2012-01-26T13:51:50.417-07:00');\n\nalert( ms ); // 1327611110417 (число миллисекунд)`</script><code-toolbar></code-toolbar></code-example><important-><h3>Формат дат для IE8-</h3><p>До появления спецификации ECMAScript 5 формат не был стандартизован, и браузеры, включая IE8-, имели свои собственные  форматы дат. Частично, эти форматы пересекаются.</p><p>Например, код ниже работает везде, включая старые IE:</p><code-example><script>`var ms = Date.parse("January 26, 2011 13:51:50");\n\nalert( ms );`</script><code-toolbar></code-toolbar></code-example><p>Вы также можете почитать о старых форматах IE в документации к методу  <a href="http://msdn.microsoft.com/en-us/library/k4w173wk%28v=vs.85%29.aspx">MSDN Date.parse</a>.</p><p>Конечно же, сейчас лучше использовать современный формат. Если же нужна поддержка IE8-, то метод  <code>Date.parse</code>, как и ряд других современных методов, добавляется библиотекой  <a href="https://github.com/kriskowal/es5-shim">es5-shim</a>.</p></important-><h2><a name="5" href="#5">Метод Date.now()</a></h2><p>Метод <code>Date.now()</code> возвращает дату сразу в виде миллисекунд.</p><p>Технически, он аналогичен вызову <code>+new Date()</code>, но в отличие от него не создаёт промежуточный объект даты, а поэтому – во много раз быстрее.</p><p>Его использование особенно рекомендуется там, где производительность при работе с датами критична. Обычно это не на веб-страницах, а, к примеру, в разработке игр на JavaScript.</p><h2><a name="6" href="#6">Итого</a></h2><ul><li>Дата и время представлены в JavaScript одним объектом:  <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Date/">Date</a>. Создать «только время» при этом нельзя, оно должно быть с датой. Список методов  <code>Date</code> вы можете найти в справочнике  <a href="http://javascript.ru/Date">Date</a> или выше.</li><li>Отсчёт месяцев начинается с нуля.</li><li>Отсчёт дней недели (для  <code>getDay()</code>) тоже начинается с нуля (и это воскресенье).</li><li>Объект  <code>Date</code> удобен тем, что автокорректируется. Благодаря этому легко сдвигать даты.</li><li>При преобразовании к числу объект  <code>Date</code> даёт количество миллисекунд, прошедших с 1 января 1970 UTC. Побочное следствие – даты можно вычитать, результатом  будет разница в миллисекундах.</li><li>Для получения текущей даты в миллисекундах лучше использовать  <code>Date.now()</code>, чтобы не создавать лишний объект  <code>Date</code> (кроме IE8-)</li><li>Для бенчмаркинга лучше использовать  <code>performance.now()</code> (кроме IE9-), он в 1000 раз точнее.</li></ul><h2 id="tasks"><a href="#7" name="7">Задачи (9)</a></h2><task-content><h3>  <a href="#17" name="17">Создайте дату</a>  <task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Создайте объект  <code>Date</code> для даты: 20 февраля 2012 года, 3 часа 12 минут.</p><p>Временная зона – местная. Выведите его на экран.</p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer style=""><close- title="закрыть" data-close_answer=""></close-><p>Дата в местной временной зоне создается при помощи  <code>new Date</code>.</p><p>Месяцы начинаются с нуля, так что февраль имеет номер 1. Параметры можно указывать с точностью до минут:</p><code-example><script>`var d = new Date(2012, 1, 20, 3, 12);\nalert( d );`</script><code-toolbar></code-toolbar></code-example></task-answer></task-content><task-content><h3>  <a href="#18" name="18">Имя дня недели</a>  <task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Создайте функцию  <code>getWeekDay(date)</code>, которая выводит текущий день недели в коротком формате „пн“, „вт“, … „вс“.</p><p>Например:</p><code-example><script>`var date = new Date(2012,0,3);  // 3 января 2012\nalert( getWeekDay(date) );      // Должно вывести 'вт'`</script></code-example><p><a href="http://plnkr.co/edit/3NpbPMyOS9fDsh2ZAsmW?p=preview" target="_blank" data-plunk-id="3NpbPMyOS9fDsh2ZAsmW">Открыть песочницу с тестами для задачи.</a></p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Метод  <code>getDay()</code> позволяет получить номер дня недели, начиная с воскресенья.</p><p>Запишем имена дней недели в массив, чтобы можно было их достать по номеру:</p><code-example><script>`function getWeekDay(date) {\n  var days = ['вс', 'пн', 'вт', 'ср', 'чт', 'пт', 'сб'];\n\n  return days[date.getDay()];\n}\n\nvar date = new Date(2014, 0, 3); // 3 января 2014\nalert( getWeekDay(date) ); // 'пт'`</script><code-toolbar></code-toolbar></code-example><p>В современных браузерах можно использовать и  <code>toLocaleString</code>:</p><code-example><script>`var date = new Date(2014, 0, 3); // 3 января 2014\nalert( date.toLocaleString('ru', {weekday: 'short'}) ); // 'Пт'`</script><code-toolbar></code-toolbar></code-example><p><a href="http://plnkr.co/edit/EWVNghJ2j6FgEMAYJcAh?p=preview" target="_blank" data-plunk-id="EWVNghJ2j6FgEMAYJcAh">Открыть решение с тестами в песочнице.</a></p></task-answer></task-content><task-content><h3>  <a href="#19" name="19">День недели в европейской нумерации</a>  <task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Напишите функцию,  <code>getLocalDay(date)</code> которая возвращает день недели для даты  <code>date</code>.</p><p>День нужно возвратить в европейской нумерации, т.е. понедельник имеет номер 1, вторник номер 2, …, воскресенье  – номер 7.</p><code-example><script>`var date = new Date(2012, 0, 3);  // 3 янв 2012\nalert( getLocalDay(date) );       // вторник, выведет 2`</script></code-example><p><a href="http://plnkr.co/edit/XiOZnxHXyH2doLP3P8po?p=preview" target="_blank" data-plunk-id="XiOZnxHXyH2doLP3P8po">Открыть песочницу с тестами для задачи.</a></p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer style=""><close- title="закрыть" data-close_answer=""></close-><p>Решение – в использовании встроенной функции  <code>getDay</code>. Она полностью подходит нашим целям, но для воскресенья возвращает 0 вместо 7:</p><code-example><script>`function getLocalDay(date) {\n\n  var day = date.getDay();\n\n  if (day == 0) { // день 0 становится 7\n    day = 7;\n  }\n\n  return day;\n}\n\nalert( getLocalDay(new Date(2012, 0, 3)) ); // 2`</script><code-toolbar></code-toolbar></code-example><p>Если удобнее, чтобы день недели начинался с нуля, то можно возвращать в функции  <code>day - 1</code>, тогда дни будут от 0 (пн) до 6(вс).</p><p><a href="http://plnkr.co/edit/0kTKCYZbhw0MjdAy0IVm?p=preview" target="_blank" data-plunk-id="0kTKCYZbhw0MjdAy0IVm">Открыть решение с тестами в песочнице.</a></p></task-answer></task-content><task-content><h3>  <a href="#20" name="20">День указанное количество дней назад</a>  <task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 4</span><p>Создайте функцию  <code>getDateAgo(date, days)</code>, которая возвращает число, которое было  <code>days</code> дней назад от даты  <code>date</code>.</p><p>Например, для 2 января 2015:</p><code-example><script>`var date = new Date(2015, 0, 2);\n\nalert( getDateAgo(date, 1) ); // 1, (1 января 2015)\nalert( getDateAgo(date, 2) ); // 31, (31 декабря 2014)\nalert( getDateAgo(date, 365) ); // 2, (2 января 2014)`</script></code-example><p>P.S. Важная деталь: в процессе вычислений функция не должна менять переданный ей объект  <code>date</code>.</p><p><a href="http://plnkr.co/edit/lYFq2Z0lshGsDJPJ9UcF?p=preview" target="_blank" data-plunk-id="lYFq2Z0lshGsDJPJ9UcF">Открыть песочницу с тестами для задачи.</a></p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Из даты  <code>date</code> нужно вычесть указанное количество дней. Это просто:</p><code-example><script>`function getDateAgo(date, days) {\n  date.setDate(date.getDate() - days);\n  return date.getDate();\n}`</script></code-example><p>Ситуацию осложняет то, что исходный объект даты не должен меняться. Это разумное требование, оно позволит  избежать сюрпризов.</p><p>Для того чтобы ему соответствовать, создадим копию объекта даты:</p><code-example><script>`function getDateAgo(date, days) {\n  var dateCopy = new Date(date);\n\n  dateCopy.setDate(date.getDate() - days);\n  return dateCopy.getDate();\n}\n\nvar date = new Date(2015, 0, 2);\n\nalert( getDateAgo(date, 1) ); // 1, (1 января 2015)\nalert( getDateAgo(date, 2) ); // 31, (31 декабря 2014)\nalert( getDateAgo(date, 365) ); // 2, (2 января 2014)`</script><code-toolbar></code-toolbar></code-example><p><a href="http://plnkr.co/edit/Q5i0eQvSkyneYcsSKuE7?p=preview" target="_blank" data-plunk-id="Q5i0eQvSkyneYcsSKuE7">Открыть решение с тестами в песочнице.</a></p></task-answer></task-content><task-content><h3>  <a href="#21" name="21">Последний день месяца?</a>  <task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Напишите функцию  <code>getLastDayOfMonth(year, month)</code>, которая возвращает последний день месяца.</p><p>Параметры:</p><ul><li>  <code>year</code> – 4-значный год, например 2012.</li><li>  <code>month</code> – месяц от 0 до 11.</li></ul><p>Например,  <code>getLastDayOfMonth(2012, 1) = 29</code> (високосный год, февраль).</p><p><a href="http://plnkr.co/edit/U7cZUpGweKoDsbX7F2Or?p=preview" target="_blank" data-plunk-id="U7cZUpGweKoDsbX7F2Or">Открыть песочницу с тестами для задачи.</a></p><button-answer data-toggle_answer="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Создадим дату из следующего месяца, но день не первый, а «нулевой» (т.е. предыдущий):</p><code-example><script>`function getLastDayOfMonth(year, month) {\n  var date = new Date(year, month + 1, 0);\n  return date.getDate();\n}\n\nalert( getLastDayOfMonth(2012, 0) ); // 31\nalert( getLastDayOfMonth(2012, 1) ); // 29\nalert( getLastDayOfMonth(2013, 1) ); // 28`</script><code-toolbar></code-toolbar></code-example><p><a href="http://plnkr.co/edit/ndPHoQAy3mdSroUIWvtM?p=preview" target="_blank" data-plunk-id="ndPHoQAy3mdSroUIWvtM">Открыть решение с тестами в песочнице.</a></p></task-answer></task-content><task-content><h3>  <a href="#22" name="22">Сколько секунд уже прошло сегодня?</a>  <task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Напишите функцию  <code>getSecondsToday()</code> которая возвращает, сколько секунд прошло с начала сегодняшнего дня.</p><p>Например, если сейчас  <code>10:00</code> и не было перехода на зимнее/летнее время, то:</p><code-example><script>`getSecondsToday() == 36000 // (3600 * 10)`</script></code-example><p>Функция должна работать в любой день, т.е. в ней не должно быть конкретного значения сегодняшней даты.</p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Для вывода достаточно сгенерировать объект  <code>Date</code>, соответствующий началу дня, т.е. «сегодня» 00 часов 00 минут 00 секунд, и вычесть его из текущей  даты.</p><p>Полученная разница – это как раз количество миллисекунд от начала дня, которое достаточно поделить на  <code>1000</code>, чтобы получить секунды:</p><code-example><script>`function getSecondsToday() {\n  var now = new Date();\n\n  // создать объект из текущей даты, без часов-минут-секунд\n  var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n\n  var diff = now - today; // разница в миллисекундах\n  return Math.floor(diff / 1000); // перевести в секунды\n}\n\nalert( getSecondsToday() );`</script><code-toolbar></code-toolbar></code-example><p>Альтернативное решение – получить часы/минуты/секунды и преобразовать их все в секунды:</p><code-example><script>`function getSecondsToday() {\n  var d = new Date();\n  return d.getHours() * 3600 + d.getMinutes() * 60 + d.getSeconds();\n};\nalert( getSecondsToday() );`</script><code-toolbar></code-toolbar></code-example></task-answer></task-content><task-content><h3>  <a href="#23" name="23">Сколько секунд - до завтра?</a>  <task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Напишите функцию  <code>getSecondsToTomorrow()</code> которая возвращает, сколько секунд осталось до завтра.</p><p>Например, если сейчас  <code>23:00</code>, то:</p><code-example><script>`getSecondsToTomorrow() == 3600`</script></code-example><p>P.S. Функция должна работать в любой день, т.е. в ней не должно быть конкретного значения сегодняшней даты.</p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Для получения оставшихся до конца дня миллисекунд нужно из «завтра 00 ч 00 мин 00 сек» вычесть текущее  время.</p><p>Чтобы сгенерировать «завтра» – увеличим текущую дату на 1 день:</p><code-example><script>`function getSecondsToTomorrow() {\n  var now = new Date();\n\n  // создать объект из завтрашней даты, без часов-минут-секунд\n  var tomorrow = new Date(now.getFullYear(), now.getMonth(), HIGHnow.getDate()+1LIGHT);\n\n  var diff = tomorrow - now; // разница в миллисекундах\n  return Math.round(diff / 1000); // перевести в секунды\n}\n\nalert( getSecondsToTomorrow() );`</script><code-toolbar></code-toolbar></code-example></task-answer></task-content><task-content><h3>  <a href="#24" name="24">Вывести дату в формате дд.мм.гг</a>  <task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 3</span><p>Напишите функцию  <code>formatDate(date)</code>, которая выводит дату  <code>date</code> в формате  <code>дд.мм.гг</code>:</p><p>Например:</p><code-example><script>`var d = new Date(2014, 0, 30); // 30 января 2014\Nalert( formatDate(d) ); // '30.01.14'`</script></code-example><p>P.S. Обратите внимание, ведущие нули должны присутствовать, то есть 1 января 2001 должно быть 01.01.01, а не  1.1.1.</p><p><a href="http://plnkr.co/edit/4EzYeXxhY0NF7gccm625?p=preview" target="_blank" data-plunk-id="4EzYeXxhY0NF7gccm625">Открыть песочницу с тестами для задачи.</a></p><button-answer data-toggle_answer="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Получим компоненты один за другим.</p><ol><li>  <p>День можно получить как <code>date.getDate()</code>. При необходимости добавим ведущий ноль:</p>  <code-example><script>`var dd = date.getDate();\nif (dd < 10) dd = '0' + dd;`</script></code-example>  </li><li>  <p><code>date.getMonth()</code> возвратит месяц, начиная с нуля. Увеличим его на 1:</p>  <code-example><script>`var mm = date.getMonth() + 1; // месяц 1-12\nif (mm < 10) mm = '0' + mm;`</script></code-example>  </li><li>  <p><code>date.getFullYear()</code> вернет год в 4-значном формате. Чтобы сделать его двузначным – воспользуемся оператором взятия остатка <code>'%'</code>:</p>  <code-example><script>`var yy = date.getFullYear() % 100;\nif (yy < 10) yy = '0' + yy;`</script></code-example>  <p>Заметим, что год, как и другие компоненты, может понадобиться дополнить нулем слева, причем возможно что <code>yy == 0</code> (например, 2000 год). При сложении со строкой <code>0+'0' == '00'</code>, так что будет все в порядке.</p>  </li></ol><p>Полный код:</p><code-example><script>`function formatDate(date) {\n\n  var dd = date.getDate();\n  if (dd < 10) dd = '0' + dd;\n\n  var mm = date.getMonth() + 1;\n  if (mm < 10) mm = '0' + mm;\n\n  var yy = date.getFullYear() % 100;\n  if (yy < 10) yy = '0' + yy;\n\n  return dd + '.' + mm + '.' + yy;\n}\n\nvar d = new Date(2014, 0, 30); // 30 Янв 2014\nalert( formatDate(d) ); // '30.01.14'`</script><code-toolbar></code-toolbar></code-example><p><a href="http://plnkr.co/edit/OwYlV6qyChrLNdZfJZ3M?p=preview" target="_blank" data-plunk-id="OwYlV6qyChrLNdZfJZ3M">Открыть решение с тестами в песочнице.</a></p></task-answer></task-content><task-content><h3>  <a href="#25" name="25">Относительное форматирование даты</a>  <task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 4</span><p>Напишите функцию  <code>formatDate(date)</code>, которая форматирует дату  <code>date</code> так:</p><ul><li>Если со времени  <code>date</code> прошло менее секунды, то возвращает  <code>"только что"</code>.</li><li>Иначе если со времени  <code>date</code> прошло менее минуты, то  <code>"n сек. назад"</code>.</li><li>Иначе если прошло меньше часа, то  <code>"m мин. назад"</code>.</li><li>Иначе полная дата в формате  <code>"дд.мм.гг чч:мм"</code>.</li></ul><p>Например:</p><code-example><script>`function formatDate(date) { /* ваш код */ }\n\nalert( formatDate(new Date(new Date - 1)) ); // "только что"\n\nalert( formatDate(new Date(new Date - 30 * 1000)) ); // "30 сек. назад"\n\nalert( formatDate(new Date(new Date - 5 * 60 * 1000)) ); // "5 мин. назад"\n\nalert( formatDate(new Date(new Date - 86400 * 1000)) ); // вчерашняя дата в формате "дд.мм.гг чч:мм"`</script></code-example><p><a href="http://plnkr.co/edit/WQKC2jQVjVELFk3JEMOT?p=preview" target="_blank" data-plunk-id="WQKC2jQVjVELFk3JEMOT">Открыть песочницу с тестами для задачи.</a></p><button-answer data-toggle_answer="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Для того, чтобы узнать время от  <code>date</code> до текущего момента – используем вычитание дат.</p><code-example><script>`function formatDate(date) {\n  var diff = new Date() - date; // разница в миллисекундах\n\n  if (diff < 1000) { // прошло менее 1 секунды\n    return 'только что';\n  }\n\n  var sec = Math.floor(diff / 1000); // округлить diff до секунд\n\n  if (sec < 60) {\n    return sec + ' сек. назад';\n  }\n\n  var min = Math.floor(diff / 60000); // округлить diff до минут\n  if (min < 60) {\n    return min + ' мин. назад';\n  }\n\n  // форматировать дату, с учетом того, что месяцы начинаются с 0\n  var d = date;\n  d = [\n    '0' + d.getDate(),\n    '0' + (d.getMonth() + 1),\n    '' + d.getFullYear(),\n    '0' + d.getHours(),\n    '0' + d.getMinutes()\n  ];\n\n  for (var i = 0; i < d.length; i++) {\n    d[i] = d[i].slice(-2);\n  }\n\n  return d.slice(0, 3).join('.') + '&nbsp' + d.slice(3).join(':');\n}\n\nalert( formatDate(new Date(new Date - 1)) ); // только что\n\nalert( formatDate(new Date(new Date - 30 * 1000)) ); // 30 сек. назад\n\nalert( formatDate(new Date(new Date - 5 * 60 * 1000)) ); // 5 мин. назад\n\nalert( formatDate(new Date(new Date - 86400 * 1000)) ); // вчерашняя дата в формате \"дд.мм.гг чч:мм\"`</script><code-toolbar></code-toolbar></code-example><p><a href="http://plnkr.co/edit/Ynli5UQBr7ybbFe3cMuA?p=preview" target="_blank" data-plunk-id="Ynli5UQBr7ybbFe3cMuA">Открыть решение с тестами в песочнице.</a></p></task-answer></task-content><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>!function () { /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || screen.width < 1024 || "bannerBottomDisabled" in localStorage || (localStorage.bannerBottomShownCount || (localStorage.bannerBottomShownCount = 1), document.querySelector(".banner-bottom").style.display = "block") }();</script><nav-book data-tooltips="Псевдомассив аргументов 'arguments'; Замыкания, область видимости"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url = "https:\/\/learn.javascript.ru\/datetime", disqus_identifier = "datetime", disqus_title = "\u0414\u0430\u0442\u0430 \u0438 \u0412\u0440\u0435\u043c\u044f";</script></page-content></main>