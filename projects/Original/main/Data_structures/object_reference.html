<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="1">Язык JavaScript</a><arrow-next></arrow-next><a data-load_page="34">Структуры данных</a></nav-up><h1>Объекты: передача по ссылке</h1><p>Фундаментальным отличием объектов от примитивов, является их хранение и копирование «по ссылке».</p><h2><a name="0" href="#0">Копирование по значению</a></h2><p>Обычные значения: строки, числа, булевы значения, <code>null/undefined</code> при присваивании переменных копируются целиком или, как говорят, <em>«по значению»</em>.</p><code-example><script>`var message = "Привет";\nvar phrase = message;`</script></code-example><p>В результате такого копирования получились две полностью независимые переменные, в каждой из которых хранится значение <code>"Привет"</code>.</p><figure><img src="variable-copy-value.png" style="max-width: 359px;
" width="100%"></figure><h2><a name="1" href="#1">Копирование по ссылке</a></h2><p>С объектами – всё не так.</p><p><strong>В переменной, которой присвоен объект, хранится не сам объект, а «адрес его места в памяти», иными словами – «ссылка» на него.</strong></p><p>Вот как выглядит переменная, которой присвоен объект:</p><code-example><script>`var user = {\n  name: "Вася"\n};`</script></code-example><figure><img src="variable-contains-reference.png" style="max-width: 337px;
" width="100%"></figure><p>Внимание: объект – вне переменной. В переменной – лишь «адрес» (ссылка) для него.</p><p><strong>При копировании переменной с объектом – копируется эта ссылка, а объект по-прежнему остается в единственном экземпляре.</strong></p><p>Например:</p><code-example><script>`var user = { name: "Вася" }; // в переменной - ссылка\n\nvar admin = user; // скопировали ссылку`</script></code-example><p>Получили две переменные, в которых находятся ссылки на один и тот же объект:</p><figure><img src="variable-copy-reference.png" style="max-width: 546px;
" width="100%"></figure><p><strong>Так как объект всего один, то изменения через любую переменную видны в других переменных:</strong></p><code-example><script>`var user = { name: 'Вася' };\n\nvar admin = user;\n\nHIGHadmin.nameLIGHT = 'Петя'; // поменяли данные через admin\n\nalert(HIGHuser.nameLIGHT); // 'Петя', изменения видны в user`</script><code-toolbar></code-toolbar></code-example><important-><h3>Переменная с объектом как «ключ» к сейфу с данными</h3><p>Ещё одна аналогия: переменная, в которую присвоен объект, на самом деле хранит не сами данные, а ключ к сейфу, где они хранятся.</p><p>При копировании её, получается что мы сделали копию ключа, но сейф по-прежнему один.</p></important-><h2><a name="2" href="#2">Клонирование объектов</a></h2><p>Иногда, на практике – очень редко, нужно скопировать объект целиком, создать именно полную независимую копию, «клон» объекта.</p><p>Что ж, можно сделать и это. Для этого нужно пройти по объекту, достать данные и скопировать на уровне примитивов.</p><p>Примерно так:</p><code-example><script>`var user = {\n  name: "Вася",\n  age: 30\n};\n\nMARKvar clone = {}; // новый пустой объект\nMARK&nbsp\nMARK// скопируем в него все свойства user\nMARKfor (var key in user) {\nMARK  clone[key] = user[key];\nMARK}\n\n// теперь clone - полностью независимая копия\nclone.name = "Петя"; // поменяли данные в clone\n\nalert( user.name ); // по-прежнему "Вася"`</script><code-toolbar></code-toolbar></code-example><p>В этом коде каждое свойство объекта <code>user</code> копируется в <code>clone</code>. Если предположить, что они примитивны, то каждое скопируется по значению и мы как раз получим полный клон.</p><p>Если же свойства объектов, в свою очередь, могут хранить ссылки на другие объекты, то нужно обойти такие подобъекты и тоже склонировать их. Это называют «глубоким» клонированием.</p><h2><a name="3" href="#3">Вывод в консоли</a></h2><div hover-style=""><p hover-style="font-size:13px" style=""><strong hover-style="color:orangered;font-size:16px" style="">Откройте консоль</strong> браузера (обычно <shortcut>F12</shortcut> и запустите следующий код:</p><code-example><script>`var time = {\n  year: 2345,\n  month: 11,\n  day: 10,\n  hour: 11,\n  minute: 12,\n  second: 13,\n  microsecond: 123456\n}\n\nconsole.log(time); // (*)\ntime.microsecond++; // (**)\n\nconsole.log(time);\ntime.microsecond++;\n\nconsole.log(time);\ntime.microsecond++;`</script><code-toolbar></code-toolbar></code-example></div><p>Как видно, в нём некий объект выводится строкой <code>(*)</code>, затем он меняется в строке <code>(**)</code> и снова выводится, и так несколько раз. Пока ничего необычного, типичная ситуация – скрипт делает какую-то работу с объектом и выводит в консоли то, как она продвигается.</p><p>Необычное – в другом!</p><p>При раскрытии каждый объект будет выглядеть примерно так (скриншот из Chrome):</p><figure><img src="object-reference-console.png" style="max-width: 312px;
" width="100%" height="480"></figure><p><strong>Судя по выводу, свойство <code>microsecond</code> всегда было равно <code>123459</code>… Или нет?</strong></p><p>Если посмотреть на код выше то, очевидно, нет! Это свойство меняется, а консоль нас просто дурит.</p><p><strong>При «раскрытии» свойств объекта в консоли – браузер всегда выводит их текущие (на момент раскрытия) значения.</strong></p><p>Так происходит именно потому, что вывод не делает «копию» текущего содержимого, а сохраняет лишь ссылку на объект. Запомните эту особенность консоли, в будущем, при отладке скриптов у вас не раз возникнет подобная ситуация.</p><h2><a name="4" href="#4">Итого</a></h2><ul><li>Объект присваивается и копируется «по ссылке». То есть, в переменной хранится не сам объект а, условно говоря, адрес в памяти, где он находится.</li><li>Если переменная-объект скопирована или передана в функцию, то копируется именно эта ссылка, а объект остаётся один в памяти.</li></ul><p>Это – одно из ключевых отличий объекта от примитива (числа, строки…), который при присвоении как раз копируется «по значению», то есть полностью.</p><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>!function () { /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || screen.width < 1024 || "bannerBottomDisabled" in localStorage || (localStorage.bannerBottomShownCount || (localStorage.bannerBottomShownCount = 1), document.querySelector(".banner-bottom").style.display = "block") }();</script><nav-book data-tooltips="Объекты: перебор свойств; Массивы с числовыми индексами"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url = "https:\/\/learn.javascript.ru\/object-reference", disqus_identifier = "object-reference", disqus_title = "\u041e\u0431\u044a\u0435\u043a\u0442\u044b: \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u043f\u043e \u0441\u0441\u044b\u043b\u043a\u0435";</script></page-content></main>