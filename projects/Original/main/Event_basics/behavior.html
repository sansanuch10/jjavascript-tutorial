<main> <page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="98">Документ, события, интерфейсы</a><arrow-next></arrow-next><a data-load_page="119">Основы работы с событиями</a></nav-up><h1>Приём проектирования "поведение"</h1><p>Шаблон проектирования «поведение» (behavior) позволяет задавать хитрые обработчики на элементе <em>декларативно</em>, установкой специальных HTML-атрибутов и классов.</p><h2><a name="0" href="#0">Описание</a></h2><p>Приём проектирования «поведение» состоит из двух частей:</p><ol><li>Элементу ставится атрибут, описывающий его поведение.</li><li>При помощи делегирования ставится обработчик на документ, который ловит все клики и, если элемент имеет нужный атрибут, производит нужное действие.</li></ol><h2><a name="1" href="#1">Пример</a></h2><p>Например, добавим «поведение», которое всем элементам, у которых стоит атрибут <code>data-counter</code>, будет при клике увеличивать значение на <code>1</code>:</p><code-example><script>`Счётчик:\n<button data-counter>1</button>\nЕщё счётчик:\n<button data-counter>2</button>\n\n<script>\n  document.onclick = function(event) {\n    if (!event.target.hasAttribute('data-counter')) return;\n\n    var counter = event.target;\n\n    counter.innerHTML++;\n  };\n<\/script>`</script><code-toolbar iframe="60"></code-toolbar></code-example><p>Если запустить HTML-код выше, то при клике на каждую кнопку – её значение будет увеличиваться.</p><p>Конечно, нам важны не счётчики, а общий подход, который они демонстрируют.</p><p>Элементов <code>data-counter</code> может быть сколько угодно. Новые могут добавляться в HTML в любой момент. При помощи делегирования мы, фактически, добавили новый «псевдо-стандартный» атрибут в HTML, который добавляет элементу новую возможность («поведение»).</p><h2><a name="2" href="#2">Ещё пример</a></h2><p>Добавим ещё поведение.</p><p>Сделаем так, что при клике на элемент с атрибутом <code>data-toggle-id</code> будет скрываться/показываться элемент с заданным <code>id</code>:</p><code-example><script>`<button HIGHdata-toggle-id="subscribe-mail"LIGHT>\n  Показать форму подписки\n</button>\n\n<form id="subscribe-mail" hidden>\n  Ваша почта: <input type="email">\n</form>\n\n<script>\nMARK  document.onclick = function(event) {\nMARK    var target = event.target;\nMARK&nbsp\nMARK    var id = target.getAttribute('data-toggle-id');\nMARK    if (!id) return;\nMARK&nbsp\nMARK    var elem = document.getElementById(id);\nMARK&nbsp\nMARK    elem.hidden = !elem.hidden;\nMARK  };\n<\/script>`</script><code-toolbar iframe="60"></code-toolbar></code-example><p>Ещё раз заметим, что мы сделали. Теперь для того, чтобы добавить скрытие-раскрытие любому элементу – даже не надо знать JavaScript, можно просто написать атрибут <code>data-toggle-id</code>.</p><p>Это бывает очень удобно – не нужно писать JavaScript-код для каждого элемента, который должен служить такой кнопкой. Просто используем поведение.</p><p>Обратите внимание: обработчик поставлен на <code>document</code>, клик на любом элементе страницы пройдёт через него, так что поведение определено глобально.</p><important-><h3>Не только атрибут</h3><p>Для своих целей мы можем использовать в HTML любые атрибуты, но стандарт рекомендует для своих целей называть атрибуты <code>data-*</code>.</p><p>В обработчике <code>document.onclick</code> мы могли бы проверять не атрибут, а класс или что-то ещё, но с атрибутом – проще и понятнее всего.</p><p>Также для добавления обработчиков на <code>document</code> рекомендуется использовать <code>addEventListener</code>, чтобы можно было добавить более одного обработчика для типа события.</p></important-><h2><a name="3" href="#3">Итого</a></h2><p>Шаблон «поведение» удобен тем, что сколь угодно сложное JavaScript-поведение можно «навесить» на элемент одним лишь атрибутом. А можно – несколькими атрибутами на связанных элементах.</p><p>Здесь мы рассмотрели базовый пример, который можно как угодно модифицировать и масштабировать. Важно не переусердствовать.</p><p>Приём разработки «поведение» рекомендуется использовать для расширения возможностей разметки, как альтернативу мини-фрагментам JavaScript.</p><h2 id="tasks"><a href="#4" name="4">Задачи (1)</a></h2><task-content><h3><a href="#7" name="7">Поведение "подсказка"</a><task-open hover-style="" data-show_task="" title="Закрыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>При наведении мыши на элемент, на нём возникает событие <code>mouseover</code>, при удалении мыши с элемента – событие <code>mouseout</code>.</p><p>Зная это, напишите JS-код, который будет делать так, что при наведении на элемент, если у него есть атрибут <code>data-tooltip</code> – над ним будет показываться подсказка с содержимым этого атрибута.</p><p>Например, две кнопки:</p><code-example><script>`<button data-tooltip="подсказка длиннее, чем элемент">Короткая кнопка</button>\n<button data-tooltip="HTML<br>подсказка">Ещё кнопка</button>`</script></code-example><p>Результат в ифрейме с документом:</p><figure- style="padding:0"><code-toolbar-><a id="answer_1" style="display:none" title="открыть в песочнице" data-code_edit=""></a><a id="task_1" title="открыть в песочнице" data-code_edit="?"></a></code-toolbar-><style> .tooltip{position:fixed;padding:10px 20px;/* красивости... */ border:1px solid #b3c9ce;border-radius:4px;text-align:center;font:italic 14px/1.3 arial,sans-serif;color:#333;background:#fff;box-shadow:3px 3px 3px rgba(0,0,0,.3);z-index:101} p-{display:block;margin:12px 0;} </style><div style="height:200px;overflow: auto;"><div style="height:2000px;margin:8px"><p->ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя</p-><p->ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя</p-><button data-tooltip_="подсказка длиннее, чем элемент">Короткая кнопка</button>&nbsp; <button data-tooltip_="HTML<br>подсказка">Ещё кнопка</button><p->Прокрутите страницу, чтобы ссылки были вверху и проверьте, правильно ли показываются подсказки.</p-></div></div><script> var showingTooltip;document.onmouseover=function(e){var target=e.target;var tooltip=target.getAttribute('data-tooltip_');if (!tooltip) return;var tooltipElem=document.createElement('div');tooltipElem.className='tooltip';tooltipElem.innerHTML=tooltip;document.body.appendChild(tooltipElem);var border=target.parentElement.parentElement.getBoundingClientRect();var coords=target.getBoundingClientRect();var left=coords.left+(target.offsetWidth-tooltipElem.offsetWidth)/2;if (left<border.left) left=border.left;/* не вылезать за левую границу окна */ var top=coords.top-tooltipElem.offsetHeight-5;if (top<border.top){/* не вылезать за верхнюю границу окна */ top=coords.top+target.offsetHeight+5;}tooltipElem.style.left=left+'px';tooltipElem.style.top=top+'px';showingTooltip=tooltipElem;};document.onmouseout=function(e){if (showingTooltip){document.body.removeChild(showingTooltip);showingTooltip=null;}};</script></figure-><p>В этой задаче можно полагать, что в элементе с атрибутом <code>data-tooltip</code> – только текст, то есть нет подэлементов.</p><p>Детали оформления:</p><ul><li>Подсказка должна появляться при наведении на элемент, по центру и на небольшом расстоянии сверху. При уходе курсора с элемента – исчезать.</li><li>Текст подсказки брать из значения атрибута <code>data-tooltip</code>. Это может быть произвольный HTML.</li><li>Оформление подсказки должно задаваться CSS.</li><li>Подсказка не должна вылезать за границы экрана, в том числе если страница частично прокручена. Если нельзя показать сверху – показывать снизу элемента.</li></ul><p>Важно: нужно использовать приём разработки «поведение», то есть поставить обработчик (точнее два) на <code>document</code>, а не на каждый элемент.</p><p>Плюс этого подхода – динамически добавленные в DOM позже элементы автоматически получат этот функционал.</p><p><a data-click="task_1">Открыть песочницу для задачи.</a></p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p><a data-click="answer_1">Открыть решение в песочнице.</a></p></task-answer></task-content><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>! function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||screen.width<1024||"bannerBottomDisabled" in localStorage||(localStorage.bannerBottomShownCount||(localStorage.bannerBottomShownCount=1),document.querySelector(".banner-bottom").style.display="block")}();</script><nav-book data-tooltips="Делегирование событий; Действия браузера по умолчанию"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url="https:\/\/learn.javascript.ru\/behavior",disqus_identifier="behavior",disqus_title="\u041f\u0440\u0438\u0451\u043c \u043f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \"\u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435\"\"";</script></page-content></main>