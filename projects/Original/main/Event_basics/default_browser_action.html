<main><page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="98">Документ, события, интерфейсы</a><arrow-next></arrow-next><a data-load_page="119">Основы работы с событиями</a></nav-up><h1>Действия браузера по умолчанию</h1><p>Многие события автоматически влекут за собой действие браузера.</p><p>Например:</p><ul><li>Клик по ссылке инициирует переход на новый URL.</li><li>Нажатие на кнопку «отправить» в форме – отсылку ее на сервер.</li><li>Двойной клик на тексте – инициирует его выделение.</li></ul><p>Если мы обрабатываем событие в JavaScript, то зачастую такое действие браузера нам не нужно. К счастью, его можно отменить.</p><h2><a name="0" href="#0">Отмена действия браузера</a></h2><p>Есть два способа отменить действие браузера:</p><ul><li><strong>Основной способ – это воспользоваться объектом события. Для отмены действия браузера существует стандартный метод <code>event.preventDefault()</code>.</strong></li><li>Если же обработчик назначен через <code>onсобытие</code> (не через <code>addEventListener</code>), то можно просто вернуть <code>false</code> из обработчика.</li></ul><p>В следующем примере при клике по ссылке переход не произойдет:</p><code-example><script>`<a href="/" onclick="return false">Нажми здесь</a>\nили\n<a href="/" onclick="event.preventDefault()">здесь</a>`</script><code-toolbar- iframe="60"><a title="показать" data-code_run=""></a><div></div></code-toolbar-></code-example><important-warn><h3>Возвращать <code>true</code> не нужно</h3><p>Обычно значение, которое возвращает обработчик события, игнорируется.</p><p>Единственное исключение – это <code>return false</code> из обработчика, назначенного через <code>onсобытие</code>.</p><p>Иногда в коде начинающих разработчиков можно увидеть <code>return</code> других значений. Но они не нужны и никак не обрабатываются.</p></important-warn><h3><a name="7" href="#7">Пример: меню</a></h3><p>Рассмотрим задачу, когда нужно создать меню для сайта, например такое:</p><code-example><script>`<ul id="menu" class="menu">\n  <li><a href="/php">PHP</a></li>\n  <li><a href="/html">HTML</a></li>\n  <li><a href="/javascript">JavaScript</a></li>\n  <li><a href="/flash">Flash</a></li>\n</ul>`</script></code-example><p>Данный пример при помощи CSS может выводиться так:</p><figure-><code-toolbar-><div></div><a title="открыть в новом окне" data-new_window=""></a><a title="открыть в песочнице" data-code_edit=""></a></code-toolbar-><style>#menu li{display:inline-block;margin:0;}#menu>li a{display:inline-block;margin:0 2px;outline:none;text-align:center;text-decoration:none;font:14px/100% Arial,Helvetica,sans-serif;padding:.5em 2em .55em;text-shadow:0 1px 1px rgba(0,0,0,.3);border-radius:.5em;box-shadow:0 1px 2px rgba(0,0,0,.2);color:#d9eef7;border:solid 1px #0076a3;background:#0095cd;}#menu>li:hover a{text-decoration:none;background:#007ead;}</style><ul id="menu"><li><a href="/php">PHP</a></li><li><a href="/html">HTML</a></li><li><a href="/javascript">JavaScript</a></li><li><a href="/flash">Flash</a></li></ul><script>menu.onclick=function(event){if (event.target.nodeName != 'A') return;var href=event.target.getAttribute('href');alert(href);return false;/* prevent url change*/};</script></figure-><p>HTML-разметка сделана так, что все элементы меню являются не кнопками, а ссылками, то есть тегами <code>&lt;a&gt;</code>.</p><p>Это потому, что некоторые посетители очень любят сочетание «правый клик – открыть в новом окне». Да, мы можем использовать и <code>&lt;button&gt;</code> и <code>&lt;span&gt;</code>, но если правый клик не работает – это их огорчает. Кроме того, если на сайт зайдёт поисковик, то по ссылке из <code>&lt;a href="..."&gt;</code> он перейдёт, а выполнить сложный JavaScript и получить результат – вряд ли захочет.</p><p>Поэтому в разметке мы используем именно <code>&lt;a&gt;</code>, но обычно клик будет обрабатываться полностью в JavaScript, а стандартное действие браузера (переход по ссылке) – отменяться.</p><p>Например, вот так:</p><code-example><script>`menu.onclick = function(event) {\n  if (event.target.nodeName != 'A') return;\n\n  var href = event.target.getAttribute('href');\n  alert( href ); // может быть подгрузка с сервера, генерация интерфейса и т.п.\n\nMARK  return false; // отменить переход по url\n};`</script></code-example><p>В конце <code>return false</code>, иначе браузер перейдёт по адресу из <code>href</code>.</p><p>Так как мы применили делегирование, то меню может увеличиваться, можно добавить вложенные списки <code>ul/li</code>, стилизовать их при помощи CSS – обработчик не потребует изменений.</p><h2><a name="1" href="#1">Другие действия браузера</a></h2><p>Действий браузера по умолчанию достаточно много.</p><p>Вот некоторые примеры событий, которые вызывают действие браузера:</p><ul><li><code>mousedown</code> – нажатие кнопкой мыши в то время как курсор находится на тексте начинает его выделение.</li><li><code>click</code> на <code>&lt;input type="checkbox"&gt;</code> – ставит или убирает галочку.</li><li><code>submit</code> – при нажатии на <code>&lt;input type="submit"&gt;</code> в форме данные отправляются на сервер.</li><li><code>wheel</code> – движение колёсика мыши инициирует прокрутку.</li><li><code>keydown</code> – при нажатии клавиши в поле ввода появляется символ.</li><li><code>contextmenu</code> – при правом клике показывается контекстное меню браузера.</li><li>…</li></ul><p>Все эти действия можно отменить, если мы хотим обработать событие исключительно при помощи JavaScript.</p><important-warn><h3>События могут быть связаны между собой</h3><p>Некоторые события естественным образом вытекают друг из друга.</p><p>Например, нажатие мышкой <code>mousedown</code> на поле ввода <code>&lt;input&gt;</code> приводит к фокусировке внутри него. Если отменить действие <code>mousedown</code>, то и фокуса не будет.</p><p>Попробуйте нажать мышкой на первый <code>&lt;input&gt;</code> – произойдёт событие <code>onfocus</code>. Это обычная ситуация.</p><p>Но если нажать на второй, то фокусировки не произойдёт.</p><code-example><script>`<input value="Фокус работает" onfocus="this.value=''">\n<input BLUE_onmousedown_BLUE="return false" onfocus="this.value=''" value="Кликни меня">`</script><code-toolbar iframe="40"></code-toolbar></code-example><p>Это потому, что отменено стандартное действие при <code>onmousedown</code>.</p><p>…С другой стороны, во второй <code>&lt;input&gt;</code> можно перейти с первого нажатием клавиши <kbd class="shortcut">Tab</kbd>, и тогда фокусировка сработает. То есть, дело здесь именно в <code>onmousedown="return false"</code>.</p></important-warn><h2><a name="2" href="#2">Особенности IE8-</a></h2><p>В IE8- для отмены действия по умолчанию нужно назначить свойство <code>event.returnValue = false</code>.</p><p>Кроссбраузерный код для отмены действия по умолчанию:</p><code-example><script>`element.onclick = function(event) {\n  event = event || window.event;\n\n  if (event.preventDefault) { // если метод существует\n    event.preventDefault(); // то вызвать его\n  } else { // иначе вариант IE8-:\n    event.returnValue = false;\n  }\n}`</script></code-example><p>Можно записать в одну строку:</p><code-example><script>`...\nevent.preventDefault ? event.preventDefault() : (event.returnValue=false);\n...`</script></code-example><h2><a name="3" href="#3">Итого</a></h2><ul><li>Браузер имеет встроенные действия при ряде событий – переход по ссылке, отправка формы и т.п. Как правило, их можно отменить.</li><li>Есть два способа отменить действие по умолчанию: первый – использовать <code>event.preventDefault()</code> (IE8-: <code>event.returnValue=false</code>), второй – <code>return false</code> из обработчика. Второй способ работает только если обработчик назначен через <code>onсобытие</code>.</li></ul><h2 id="tasks"><a href="#4" name="4">Задачи (3)</a></h2><task-content><h3><a href="#8" name="8">Почему не работает return false?</a><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 3</span><p>Почему в этом документе <code>return false</code> не работает?</p><code-example><script>`<script>\n  function handler() {\n    alert( "..." );\n    return false;\n  }\n<\/script>\n\n<a href="http://w3.org" onclick="handler()">w3.org</a>`</script><code-toolbar iframe="40"></code-toolbar></code-example><p>По замыслу, переход на <code>w3.org</code> при клике должен отменяться. Однако, на самом деле он происходит.</p><p>В чём дело и как поправить?</p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Дело в том, что обработчик из атрибута <code>onclick</code> делается браузером как функция с заданным телом.</p><p>То есть, в данном случае он будет таким:</p><code-example><script>`function(event) {\n  handler() // тело взято из атрибута onclick\n}`</script></code-example><p>При этом возвращаемое <code>handler</code> значение никак не используется и не влияет на результат.</p><p>Рабочий вариант:</p><code-example><script>`<script>\n  function handler() {\n    alert("...");\n    return false;\n  }\n<\/script>\n\n<a href="http://w3.org" onclick="HIGHreturn handler()LIGHT">w3.org</a>`</script><code-toolbar iframe="40"></code-toolbar></code-example><p>Также можно использовать объект события для вызова <code>event.preventDefault()</code>, например:</p><code-example><script>`<script>\nMARK  function handler(event) {\nMARK    alert("...");\nMARK    event.preventDefault();\nMARK  }\n<\/script>\n\n<a href="http://w3.org" onclick="HIGHhandler(event)LIGHT">w3.org</a>`</script><code-toolbar iframe="40"></code-toolbar></code-example></task-answer></task-content><task-content><h3><a href="#9" name="9">Поймайте переход по ссылке</a><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Сделайте так, чтобы при клике на ссылки внутри элемента <code>#contents</code> пользователю выводился вопрос о том, действительно ли он хочет покинуть страницу и если он не хочет, то прерывать переход по ссылке.</p><p>Так это должно работать:</p><figure-><code-toolbar-><a id="answer_2" style="display:none" data-code_edit=""></a><a id="task_2" title="открыть в песочнице" data-code_edit="?"></a></code-toolbar-><style> #contents{padding:5px;border:1px green solid;} </style><fieldset id="contents"><legend>#contents</legend><p>Как насчет почитать <a href="http://wikipedia.org">Википедию</a>, или посетить <a href="http://w3.org"><i>W3.org</i></a> и узнать про современные стандарты?</p></fieldset><script> document.getElementById('contents').onclick=function(event){function handleLink(href){var isLeaving=confirm('Уйти на '+href+'?');if (!isLeaving) return false;}var target=event.target;while (target != this){if (target.nodeName == 'A'){return handleLink(target.getAttribute('href'));}target=target.parentNode;}}</script></figure-><p>Детали:</p><ul><li>Содержимое <code>#contents</code> может быть загружено динамически и присвоено при помощи <code>innerHTML</code>. Так что найти все ссылки и поставить на них обработчики нельзя. Используйте делегирование.</li><li>Содержимое может содержать вложенные теги, <em>в том числе внутри ссылок</em>, например, <code>&lt;a href=".."&gt;&lt;i&gt;...&lt;/i&gt;&lt;/a&gt;</code>.</li></ul><p><a data-click="task_2">Открыть песочницу для задачи.</a></p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Это – классическая задача на тему делегирования.</p><p>В реальной жизни, мы можем перехватить событие и создать AJAX-запрос к серверу, который сохранит информацию о том, по какой ссылке ушел посетитель.</p><p>Мы перехватываем событие на <code>contents</code> и поднимаемся до <code>parentNode</code> пока не получим <code>A</code> или не упремся в контейнер.</p><code-example><script>`contents.onclick = function(evt) {\n  var target = evt.target;\n\n  function handleLink(href) {\n    var isLeaving = confirm('Уйти на ' + href + '?');\n    if (!isLeaving) return false;\n  }\n\n  while (target != this) {\n    if (target.nodeName == 'A') {\nMARK      return handleLink(target.getAttribute('href')); // (*)\n    }\n    target = target.parentNode;\n  }\n};`</script></code-example><p>В строке <code>(*)</code> используется атрибут, а не свойство <code>href</code>, чтобы показать в <code>confirm</code> именно то, что написано в HTML-атрибуте, так как свойство может отличаться, оно обязано содержать полный валидный адрес.</p><p><a data-click="answer_2">Открыть решение в песочнице.</a></p></task-answer></task-content><task-content><h3><a href="#10" name="10">Галерея изображений</a><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Создайте галерею изображений, в которой основное изображение изменяется при клике на уменьшенный вариант.</p><p>Результат должен выглядеть так:</p><figure- style="height: 570px;overflow: scroll;"><style>h2{font:bold 190%/100% Arial,Helvetica,sans-serif;margin:0 0 .2em;}h2 em{font:normal 80%/100% Arial,Helvetica,sans-serif;color:#999999;}#largeImg{border:solid 1px #ccc;width:550px;height:400px;padding:5px;}#thumbs a{border:solid 1px #ccc;width:100px;height:100px;padding:3px;margin:2px;float:left;}#thumbs a:hover{border-color:#FF9900;}#thumbs li{list-style:none;}#thumbs{margin:0;padding:0;}</style><p><img id="largeImg" src="img5-lg.jpg" alt="Image 5"></p><ul id="thumbs"><!-- При наведении на изображение показывается встроенная подсказка браузера (title) --><li><a href="img2-lg.jpg" title="Image 2"><img src="img2-thumb.jpg"></a></li><li><a href="img3-lg.jpg" title="Image 3"><img src="img3-thumb.jpg"></a></li><li><a href="img4-lg.jpg" title="Image 4"><img src="img4-thumb.jpg"></a></li><li><a href="img5-lg.jpg" title="Image 5"><img src="img5-thumb.jpg"></a></li><li><a href="img6-lg.jpg" title="Image 6"><img src="img6-thumb.jpg"></a></li></ul><script> var largeImg=document.getElementById('largeImg');var thumbs=document.getElementById('thumbs');thumbs.onclick=function(e){var target=e.target;while (target != this){if (target.nodeName == 'A'){showThumbnail(target.getAttribute('href'),target.title);return false;}target=target.parentNode;}};function showThumbnail(href,title){largeImg.src=href;largeImg.alt=title;}/* предзагрузка */ var imgs=thumbs.getElementsByTagName('img');for (var i=0;i<imgs.length;i++){var url=imgs[i].parentNode.href;var img=document.createElement('img');img.src=url;}</script></figure-><p>Для обработки событий используйте делегирование, т.е. не более одного обработчика.</p><p>P.S. Обратите внимание – клик может быть как на маленьком изображении <code>IMG</code>, так и на <code>A</code> вне него. При этом <code>event.target</code> будет, соответственно, либо <code>IMG</code>, либо <code>A</code>.</p><p>Дополнительно:</p><ul><li>Если получится – сделайте предзагрузку больших изображений, чтобы при клике они появлялись сразу.</li><li>Всё ли в порядке с семантической вёрсткой в HTML исходного документа? Если нет – поправьте, чтобы было, как нужно.</li></ul><p><a href="http://plnkr.co/edit/y2m7FvOQOej9cYvDH1kH?p=preview" target="_blank">Открыть песочницу для задачи.</a></p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer><close- title="закрыть" data-close_answer=""></close-><p>Решение состоит в том, чтобы добавить обработчик на контейнер <code>#thumbs</code> и отслеживать клики на ссылках.</p><p>Когда происходит событие, обработчик должен изменять <code>src</code><code>#largeImg</code> на <code>href</code> ссылки и заменять <code>alt</code> на ее <code>title</code>.</p><p>Код решения:</p><code-example><script>`var largeImg = document.getElementById('largeImg');\n\ndocument.getElementById('thumbs').onclick = function(e) {\n  var target = e.target;\n\n  while (target != this) {\n\n    if (target.nodeName == 'A') {\n      showThumbnail(target.href, target.title);\n      return false;\n    }\n\n    target = target.parentNode;\n  }\n\n}\n\nfunction showThumbnail(href, title) {\n  largeImg.src = href;\n  largeImg.alt = title;\n}`</script></code-example><p><strong>Предзагрузка картинок</strong></p><p>Для того, чтобы картинка загрузилась, достаточно создать новый элемент <code>IMG</code> и указать ему <code>src</code>, вот так:</p><code-example><script>`var imgs = thumbs.getElementsByTagName('img');\nfor (var i = 0; i < imgs.length; i++) {\n  var url = imgs[i].parentNode.href;\n\nMARK  var img = document.createElement('img');\nMARK  img.src = url;\n}`</script></code-example><p>Как только элемент создан и ему назначен <code>src</code>, браузер сам начинает скачивать файл картинки.</p><p>При правильных настройках сервера как-то использовать этот элемент не обязательно – картинка уже закеширована.</p><p><strong>Семантичная верстка</strong></p><p>Для списка картинок используется <code>DIV</code>. С точки зрения семантики более верный вариант – список <code>UL/LI</code>.</p><p><a href="http://plnkr.co/edit/5t7oDEbrx8G3UjUqtM2q?p=preview" target="_blank">Открыть решение в песочнице.</a></p></task-answer></task-content><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>! function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||screen.width<1024||"bannerBottomDisabled" in localStorage||(localStorage.bannerBottomShownCount||(localStorage.bannerBottomShownCount=1),document.querySelector(".banner-bottom").style.display="block")}();</script><nav-book data-tooltips="Приём проектирования 'поведение'; Генерация событий на элементах"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script>disqus_url="https:\/\/learn.javascript.ru\/default-browser-action",disqus_identifier="default-browser-action",disqus_title="\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e";</script></page-content></main>