<main> <page-content><nav-up><home- data-load_page="0" hover-style=""></home-><arrow-next></arrow-next><a data-load_page="98">Документ, события, интерфейсы</a><arrow-next></arrow-next><a data-load_page="119">Основы работы с событиями</a></nav-up><h1>Объект события</h1><p>Чтобы хорошо обработать событие, недостаточно знать о том, что это – «клик» или «нажатие клавиши». Могут понадобиться детали: координаты курсора, введённый символ и другие, в зависимости от события.</p><p>Детали произошедшего браузер записывает в «объект события», который передаётся первым аргументом в обработчик.</p><h2><a name="0" href="#0">Свойства объекта события</a></h2><p>Пример ниже демонстрирует использование объекта события:</p><code-example><script>`<input type="button" value="Нажми меня" id="elem">\n\n<script>\n  elem.onclick = function(HIGHeventLIGHT) {\n    // вывести тип события, элемент и координаты клика\n    alert(event.type + " на " + event.currentTarget);\n    alert(event.clientX + ":" + event.clientY);\n  }\n<\/script>`</script><code-toolbar iframe="40"></code-toolbar></code-example><p>Свойства объекта <code>event</code>:</p><dl><dt><code>event.type</code></dt><dd>Тип события, в данном случае <code>click</code></dd><dt><code>event.currentTarget</code></dt><dd>Элемент, на котором сработал обработчик. Значение – в точности такое же, как и у <code>this</code>, но бывают ситуации, когда обработчик является методом объекта и его <code>this</code> при помощи <code>bind</code> привязан к этому объекту, тогда мы можем использовать <code>event.currentTarget</code>.</dd><dt><code>event.clientX / event.clientY</code></dt><dd>Координаты курсора в момент клика (относительно окна)</dd></dl><p>Есть также и ряд других свойств, в зависимости от событий, которые мы разберём в дальнейших главах, когда будем подробно знакомиться с событиями мыши, клавиатуры и так далее.</p><important-><h3>Объект события доступен и в HTML</h3><p>При назначении обработчика в HTML, тоже можно использовать переменную <code>event</code>, это будет работать кросс-браузерно:</p><code-example><script>`<input type="button" onclick="alert(event.type)" value="Тип события">`</script><code-toolbar- iframe="50"><a title="показать" data-code_run=""></a><div></div></code-toolbar-></code-example><p>Это возможно потому, что когда браузер из атрибута создаёт функцию-обработчик, то она выглядит так: <code>function(event) { alert(event.type) }</code>. То есть, её первый аргумент называется <code>"event"</code>.</p></important-><h2><a name="1" href="#1">Особенности IE8-</a></h2><p>IE8- вместо передачи параметра обработчику создаёт глобальный объект <code>window.event</code>. Обработчик может обратиться к нему.</p><p>Работает это так:</p><code-example><script>`elem.onclick = function() {\n  // window.event - объект события\n  alert( window.event.clientX );\n};`</script></code-example><h3><a name="6" href="#6">Кроссбраузерное решение</a></h3><p>Универсальное решение для получения объекта события:</p><code-example><script>`element.onclick = function(event) {\n  event = event || window.event; // (*)\n\n  // Теперь event - объект события во всех браузерах.\n};`</script></code-example><p>Строка <code>(*)</code>, в случае, если функция не получила <code>event</code> (IE8-), использует <code>window.event</code>.-событие <code>event</code>.</p><p>Можно написать и иначе, если мы сами не используем переменную <code>event</code> в замыкании:</p><code-example><script>`element.onclick = function(e) {\n  e = e || event;\n\n  // Теперь e - объект события во всех браузерах.\n};`</script></code-example><h2><a name="2" href="#2">Итого</a></h2><ul><li>Объект события содержит ценную информацию о деталях события.</li><li>Он передается первым аргументом <code>event</code> в обработчик для всех браузеров, кроме IE8-, в которых используется глобальная переменная <code>window.event</code>.</li></ul><p>Кросс-браузерно для JavaScript-обработчика получаем объект события так:</p><code-example><script>`element.onclick = function(event) {\n  event = event || window.event;\n\n  // Теперь event - объект события во всех браузерах.\n};`</script></code-example><p>Еще вариант:</p><code-example><script>`element.onclick = function(e) {\n  e = e || event; // если нет другой внешней переменной event\n  ...\n};`</script></code-example><h2 id="tasks"><a href="#3" name="3">Задачи (1)</a></h2><task-content><h3><a href="#7" name="7">Передвигать мяч по полю</a><task-open hover-style="" data-show_task="" title="Открыть задачу"></task-open></h3><span title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span><p>Сделайте так, что при клике по полю мяч перемещался на место клика.</p><figure><code-toolbar-><a-></a-><a title="открыть в новом окне" data-new_window=""></a><a title="открыть в песочнице" data-code_edit=""></a></code-toolbar-><iframe style="height:260px" src="js_move_ball.html"></iframe></figure><p>Требования:</p><ul><li>Мяч после перелёта должен становиться центром ровно под курсор мыши, если это возможно без вылета за край поля. </li><li>CSS-анимация не обязательна, но желательна.</li><li>Мяч должен останавливаться у границ поля, ни в коем случае не вылетать за них.</li><li>При прокрутке страницы с полем ничего не должно ломаться.</li></ul><p>Замечания:</p><ul><li>Код не должен зависеть от конкретных размеров мяча и поля.</li><li>Вам пригодятся свойства <code>event.clientX/event.clientY</code></li></ul><p><a data-click="task_1">Открыть песочницу для задачи.</a></p><button-answer data-toggle_answer="" style="">решение</button-answer><task-answer-ext><button-answer-ext data-toggle_answer_ext="" style="">Мяч под курсор мыши</button-answer-ext><task-answer><close- title="закрыть" data-close_answer=""></close-><h4>Мяч под курсор мыши</h4><p>Основная сложность первого этапа – сдвинуть мяч под курсор, т.к. координаты клика <code>e.clientX/Y</code> – относительно окна, а мяч позиционирован абсолютно внутри поля, его координаты <code>left/top</code> нужно ставить относительно левого-верхнего внутреннего (внутри рамки!) угла поля.</p><p>Чтобы правильно вычислить координаты мяча, нужно получить координаты угла поля и вычесть их из <code>clientX/Y</code>:</p><p>Далее мяч нужно сдвинуть на половину его ширины и высоты <code>ball.clientWidth/clientHeight</code>, чтобы он оказался центром под курсором.</p><p>Здесь есть важный «подводный камень» – размеры мяча в исходном документе не прописаны. Там просто стоит <code>&lt;img&gt;</code>. Но на момент выполнения JavaScript картинка, возможно, ещё не загрузилась, так что высота и ширина мяча будут неизвестны (а они необходимы для центрирования).</p><p>Нужно добавить <code>width/height</code> в тег <code>&lt;img&gt;</code> или задать размеры в CSS, тогда на момент выполнения JavaScript будет знать их и передвинет мяч правильно.</p><p>Код, который полностью центрирует мяч, вы найдете в полном решении:</p><code-example><script>`<style>\n  GOLD_#field_GOLD {\n    width: 200px;\n    height: 150px;\n    border: 10px groove black;\n    background: #00FF00;\n    position: relative;\n    overflow: hidden;\n    cursor: pointer;\n  }\n\n  GOLD_#ball_GOLD {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 40px;\n    height: 40px;\n    transition: all 1s;\n  }\n</style>\n\nКликните на любое место поля, чтобы мяч перелетел туда.\n<div id="field">\n  <svg id="ball" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><circle fill="#FFF" cx="20" cy="20" r="20"></circle><path d="M38.076 11.433A19.973 19.973 0 0 0 20 0c-2.458 0-4.858.441-7.134 1.31A20.056 20.056 0 0 0 2.47 10.365 20.012 20.012 0 0 0 0 20c0 .894.06 1.792.177 2.671a19.954 19.954 0 0 0 7.968 13.438l.078.058h.002A19.85 19.85 0 0 0 20 40a19.868 19.868 0 0 0 14.122-5.838A19.962 19.962 0 0 0 40 20c0-2.997-.647-5.88-1.924-8.567zM33.67 33.16l2.396-6.393 2.912-5.505.373.219a19.372 19.372 0 0 1-5.413 12.021l-.268-.342zm-21.522 2.736l-1.56-5.091 6.237-2.814 7.503 2.341 1.42 4.994-6.292 2.958-7.308-2.388zM13.27 5.16l6.466 1.686 1.007 6.923-5.804 5.518-6.873-1.694-1.153-7.004L13.27 5.16zm25.278 15.648l-2.892 5.467-4.524-1.736-1.65-8.082 3.222-5.183 4.12 1.539 1.724 7.995zm-17.411-6.595l7.775 2.419 1.636 8.012-6.046 5.122-7.444-2.323-1.707-7.729 5.786-5.5zm16.329-2.681l-.496.702-4.218-1.575-5.117-5.697v-2.81a19.38 19.38 0 0 1 9.83 9.38zM27.04 1.912v2.922l-7.033 1.47-6.532-1.703-.193-2.812A19.336 19.336 0 0 1 20 .594c2.432 0 4.8.444 7.041 1.318zM2.908 10.803l3.433-.032 1.156 7.026-2.707 6.317H1.693l-.935-1.581a19.422 19.422 0 0 1 2.15-11.73zM1.745 26.6l.066-1.89h3.036l5.114 6.078 1.537 5.018-3.07-.224A19.358 19.358 0 0 1 1.745 26.6zm18.027 12.807v-.614l6.437-3.026 7.018-2.208.288.368a19.277 19.277 0 0 1-13.743 5.48z" hover-style="fill:blue" fill="#000"></path></g></svg>        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .\n   . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .\n</div>\n\n<script>\n  field.onclick = function(event) {\n\n    // координаты поля относительно окна\n    var fieldCoords = this.getBoundingClientRect();\n\n    // координаты левого-верхнего внутреннего угла поля\n    var fieldInnerCoords = {\n      top: fieldCoords.top + field.clientTop,\n      left: fieldCoords.left + field.clientLeft\n    };\n\n    // разместить по клику,\n    // но сдвинув относительно поля (т.к. position:relative)\n    // и сдвинув на половину ширины/высоты\n    // (!) используются координаты относительно окна clientX/Y, как и в fieldCoords\n    var ballCoords = {\n      top: event.clientY - fieldInnerCoords.top - ball.clientHeight / 2,\n      left: event.clientX - fieldInnerCoords.left - ball.clientWidth / 2\n    };\n\n    // вылезает за верхнюю границу - разместить по ней\n    if (ballCoords.top < 0) ballCoords.top = 0;\n\n    // вылезает за левую границу - разместить по ней\n    if (ballCoords.left < 0) ballCoords.left = 0;\n\n\n    // вылезает за правую границу - разместить по ней\n    if (ballCoords.left + ball.clientWidth > field.clientWidth) {\n      ballCoords.left = field.clientWidth - ball.clientWidth;\n    }\n\n    // вылезает за нижнюю границу - разместить по ней\n    if (ballCoords.top + ball.clientHeight > field.clientHeight) {\n      ballCoords.top = field.clientHeight - ball.clientHeight;\n    }\n\n    ball.style.left = ballCoords.left + 'px';\n    ball.style.top = ballCoords.top + 'px';\n  }\n<\/script>`</script><code-toolbar iframe="300"><a data-code_run="30" title="показать"></a><a id="task_1" data-code_edit="?" style="display:none"></a><a id="answer_1" title="открыть в песочнице" data-code_edit=""></a></code-toolbar></code-example><p><a data-click="answer_1">Открыть решение в песочнице.</a></p></task-answer></task-answer-ext></task-content><banner-bottom class="banner-bottom" style="display: block;"></banner-bottom><script>! function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||screen.width<1024||"bannerBottomDisabled" in localStorage||(localStorage.bannerBottomShownCount||(localStorage.bannerBottomShownCount=1),document.querySelector(".banner-bottom").style.display="block")}();</script><nav-book data-tooltips="Порядок обработки событий; Всплытие и перехват"></nav-book><share-map><share-></share-><map-button hover-style="" data-load_page="l"></map-button></share-map><comments- id="comments"></comments-><div id="disqus_thread"></div><script> disqus_url="https:\/\/learn.javascript.ru\/obtaining-event-object",disqus_identifier="obtaining-event-object",disqus_title="\u041e\u0431\u044a\u0435\u043a\u0442 \u0441\u043e\u0431\u044b\u0442\u0438\u044f";</script></page-content></main>